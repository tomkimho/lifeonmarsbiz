<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>BizPlanner - Smart Business Planner</title>
<meta name="description" content="ì¼ì •, í• ì¼, ë©”ëª¨, ì—°ë½ì²˜ë¥¼ í•œê³³ì—ì„œ ê´€ë¦¬í•˜ì„¸ìš”">
<meta name="theme-color" content="#0F172A">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“…</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<style>
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin:0;padding:0}
body{font-family:'Noto Sans KR',sans-serif;background:#F1F5F9;overflow-x:hidden}
input,select,textarea,button{font-family:'Noto Sans KR',sans-serif}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:#CBD5E1;border-radius:4px}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes slideUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
.sr:hover{background:#F1F5F9!important}
.card:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.08)!important}
@media(max-width:480px){input,textarea,select{font-size:16px!important}}
.multi-bar{position:absolute;height:5px;border-radius:3px;z-index:2;top:0;cursor:pointer}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useCallback,useRef,useMemo}=React;

// â”€â”€â”€ Constants â”€â”€â”€
const DAYS=["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];
const MOS=["1ì›”","2ì›”","3ì›”","4ì›”","5ì›”","6ì›”","7ì›”","8ì›”","9ì›”","10ì›”","11ì›”","12ì›”"];
const PRI={high:{bg:"#FEE2E2",text:"#DC2626",dot:"#EF4444",label:"ìƒ"},medium:{bg:"#FFF7ED",text:"#EA580C",dot:"#F97316",label:"ì¤‘"},low:{bg:"#EFF6FF",text:"#2563EB",dot:"#3B82F6",label:"í•˜"}};
const CAT={meeting:{i:"ğŸ¤",l:"ë¯¸íŒ…"},call:{i:"ğŸ“",l:"í†µí™”"},task:{i:"ğŸ“‹",l:"ì—…ë¬´"},travel:{i:"âœˆï¸",l:"ì¶œì¥"},personal:{i:"ğŸ‘¤",l:"ê°œì¸"},deadline:{i:"â°",l:"ë§ˆê°"}};
const MT={free:{icon:"ğŸ“",label:"ììœ  ë©”ëª¨",color:"#6366F1"},schedule:{icon:"ğŸ“…",label:"ì¼ì • ë©”ëª¨",color:"#0EA5E9"},meeting:{icon:"ğŸ¤",label:"íšŒì˜ë¡",color:"#10B981"},idea:{icon:"ğŸ’¡",label:"ì•„ì´ë””ì–´",color:"#F59E0B"},diary:{icon:"ğŸ“”",label:"ì¼ê¸°",color:"#EC4899"}};
const ALARMS=[{v:0,l:"ì •ì‹œ"},{v:5,l:"5ë¶„ ì „"},{v:10,l:"10ë¶„ ì „"},{v:15,l:"15ë¶„ ì „"},{v:30,l:"30ë¶„ ì „"},{v:60,l:"1ì‹œê°„ ì „"},{v:1440,l:"1ì¼ ì „"}];
const TCATS=["ì—…ë¬´","ê°œì¸","í”„ë¡œì íŠ¸","ì—°êµ¬","ê¸°íƒ€"];
const uid=()=>Date.now().toString(36)+Math.random().toString(36).substr(2,9);
const fmt=d=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
const pD=s=>{const[y,m,d]=s.split("-").map(Number);return new Date(y,m-1,d);};
const dBtw=(a,b)=>Math.floor((pD(b)-pD(a))/864e5);
const getNow=()=>new Date();
const TODAY=fmt(new Date());

// â”€â”€â”€ Korean Holidays (2025-2027) â”€â”€â”€
const HOLIDAYS={
  "2025-01-01":"ìƒˆí•´","2025-01-28":"ì„¤ë‚  ì—°íœ´","2025-01-29":"ì„¤ë‚ ","2025-01-30":"ì„¤ë‚  ì—°íœ´",
  "2025-03-01":"ì‚¼ì¼ì ˆ","2025-05-05":"ì–´ë¦°ì´ë‚ ","2025-05-06":"ëŒ€ì²´ê³µíœ´ì¼",
  "2025-05-15":"ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ","2025-06-06":"í˜„ì¶©ì¼","2025-08-15":"ê´‘ë³µì ˆ",
  "2025-10-03":"ê°œì²œì ˆ","2025-10-05":"ì¶”ì„ ì—°íœ´","2025-10-06":"ì¶”ì„","2025-10-07":"ì¶”ì„ ì—°íœ´",
  "2025-10-08":"ëŒ€ì²´ê³µíœ´ì¼","2025-10-09":"í•œê¸€ë‚ ","2025-12-25":"ì„±íƒ„ì ˆ",
  "2026-01-01":"ìƒˆí•´","2026-02-16":"ì„¤ë‚  ì—°íœ´","2026-02-17":"ì„¤ë‚ ","2026-02-18":"ì„¤ë‚  ì—°íœ´",
  "2026-03-01":"ì‚¼ì¼ì ˆ","2026-03-02":"ëŒ€ì²´ê³µíœ´ì¼","2026-05-05":"ì–´ë¦°ì´ë‚ ",
  "2026-05-24":"ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ","2026-06-06":"í˜„ì¶©ì¼","2026-08-15":"ê´‘ë³µì ˆ",
  "2026-08-17":"ëŒ€ì²´ê³µíœ´ì¼","2026-09-24":"ì¶”ì„ ì—°íœ´","2026-09-25":"ì¶”ì„","2026-09-26":"ì¶”ì„ ì—°íœ´",
  "2026-10-03":"ê°œì²œì ˆ","2026-10-09":"í•œê¸€ë‚ ","2026-12-25":"ì„±íƒ„ì ˆ",
  "2027-01-01":"ìƒˆí•´","2027-02-06":"ì„¤ë‚  ì—°íœ´","2027-02-07":"ì„¤ë‚ ","2027-02-08":"ì„¤ë‚  ì—°íœ´",
  "2027-02-09":"ëŒ€ì²´ê³µíœ´ì¼","2027-03-01":"ì‚¼ì¼ì ˆ","2027-05-05":"ì–´ë¦°ì´ë‚ ",
  "2027-05-13":"ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ","2027-06-06":"í˜„ì¶©ì¼","2027-08-15":"ê´‘ë³µì ˆ",
  "2027-08-16":"ëŒ€ì²´ê³µíœ´ì¼","2027-10-03":"ê°œì²œì ˆ","2027-10-09":"í•œê¸€ë‚ ",
  "2027-10-14":"ì¶”ì„ ì—°íœ´","2027-10-15":"ì¶”ì„","2027-10-16":"ì¶”ì„ ì—°íœ´","2027-12-25":"ì„±íƒ„ì ˆ"
};

// â”€â”€â”€ Time helpers â”€â”€â”€
function isEventPast(ev){
  const now=getNow();
  const endD=ev.endDate||ev.date;
  const endT=ev.endTime||ev.time||"23:59";
  const[h,m]=(endT).split(":").map(Number);
  const end=new Date(pD(endD));end.setHours(h,m,0,0);
  return now>end;
}
function isEventOngoing(ev){
  const now=getNow();
  const[sh,sm]=(ev.time||"00:00").split(":").map(Number);
  const start=new Date(pD(ev.date));start.setHours(sh,sm,0,0);
  const endD=ev.endDate||ev.date;
  const[eh,em]=(ev.endTime||ev.time||"23:59").split(":").map(Number);
  const end=new Date(pD(endD));end.setHours(eh,em,0,0);
  return now>=start&&now<=end;
}
function eventDates(ev){
  const s=ev.date;const e=ev.endDate||ev.date;
  const dates=[];let cur=pD(s);const end=pD(e);
  while(cur<=end){dates.push(fmt(cur));cur.setDate(cur.getDate()+1);}
  return dates;
}

// â”€â”€â”€ LocalStorage â”€â”€â”€
function ld(k,fb){try{const r=localStorage.getItem(k);return r?JSON.parse(r):fb;}catch{return fb;}}
function sv(k,d){try{localStorage.setItem(k,JSON.stringify(d));}catch(e){console.error(e);}}

// â”€â”€â”€ Share URL Helpers â”€â”€â”€
function encodeShare(item){
  const d={t:item.title||"",d:item.date||"",ed:item.endDate||"",tm:item.time||"",et:item.endTime||"",l:item.location||"",a:item.attendees||"",m:item.memo||item.content||"",c:item.company||"",cat:item.category||"",dec:item.decisions||"",act:item.actionItems||"",type:item.type||""};
  try{return btoa(unescape(encodeURIComponent(JSON.stringify(d))));}catch{return"";}
}
function decodeShare(hash){
  try{return JSON.parse(decodeURIComponent(escape(atob(hash))));}catch{return null;}
}

// â”€â”€â”€ ICS Export â”€â”€â”€
function toICS(event){
  const dt=d=>(d||"").replace(/-/g,"");
  const tm=t=>(t||"0000").replace(/:/g,"")+"00";
  const now=new Date();const stamp=now.toISOString().replace(/[-:]/g,"").replace(/\.\d+/,"");
  const sd=dt(event.date);const st=tm(event.time);
  const ed=dt(event.endDate||event.date);const et=tm(event.endTime||event.time);
  const u=event.id+"@bizplanner";
  let desc=(event.memo||event.content||"").replace(/\n/g,"\\n");
  if(event.attendees)desc=`ì°¸ì„ì: ${event.attendees}\\n`+desc;
  if(event.company)desc=`íšŒì‚¬: ${event.company}\\n`+desc;
  const lines=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//BizPlanner//KO","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",
    `DTSTART:${sd}T${st}`,`DTEND:${ed}T${et}`,`DTSTAMP:${stamp}`,`UID:${u}`,
    `SUMMARY:${(event.title||"").replace(/,/g,"\\,")}`,
    event.location?`LOCATION:${event.location.replace(/,/g,"\\,")}`:"",
    desc?`DESCRIPTION:${desc}`:"",
    event.alarm>=0?`BEGIN:VALARM\nTRIGGER:-PT${event.alarm||0}M\nACTION:DISPLAY\nDESCRIPTION:ì•Œë¦¼\nEND:VALARM`:"",
    "END:VEVENT","END:VCALENDAR"].filter(Boolean);
  return lines.join("\r\n");
}
function downloadICS(event){
  const ics=toICS(event);const blob=new Blob([ics],{type:"text/calendar;charset=utf-8"});
  const url=URL.createObjectURL(blob);const a=document.createElement("a");
  a.href=url;a.download=`${(event.title||"ì¼ì •").replace(/[^ê°€-í£a-zA-Z0-9]/g,"_")}.ics`;a.click();URL.revokeObjectURL(url);
}
function downloadAllICS(events){
  const lines=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//BizPlanner//KO","CALSCALE:GREGORIAN","METHOD:PUBLISH"];
  const now=new Date();const stamp=now.toISOString().replace(/[-:]/g,"").replace(/\.\d+/,"");
  events.forEach(ev=>{
    const dt=d=>(d||"").replace(/-/g,"");const tm=t=>(t||"0000").replace(/:/g,"")+"00";
    let desc=(ev.memo||"").replace(/\n/g,"\\n");
    if(ev.attendees)desc=`ì°¸ì„ì: ${ev.attendees}\\n`+desc;
    if(ev.company)desc=`íšŒì‚¬: ${ev.company}\\n`+desc;
    lines.push("BEGIN:VEVENT",`DTSTART:${dt(ev.date)}T${tm(ev.time)}`,`DTEND:${dt(ev.endDate||ev.date)}T${tm(ev.endTime||ev.time)}`,
      `DTSTAMP:${stamp}`,`UID:${ev.id}@bizplanner`,`SUMMARY:${(ev.title||"").replace(/,/g,"\\,")}`,
      ev.location?`LOCATION:${ev.location.replace(/,/g,"\\,")}`:"",desc?`DESCRIPTION:${desc}`:"",
      ev.alarm>=0?`BEGIN:VALARM\nTRIGGER:-PT${ev.alarm||0}M\nACTION:DISPLAY\nDESCRIPTION:ì•Œë¦¼\nEND:VALARM`:"",
      "END:VEVENT");
  });
  lines.push("END:VCALENDAR");
  const ics=lines.filter(Boolean).join("\r\n");const blob=new Blob([ics],{type:"text/calendar;charset=utf-8"});
  const url=URL.createObjectURL(blob);const a=document.createElement("a");
  a.href=url;a.download=`BizPlanner_${TODAY}_ì „ì²´ì¼ì •.ics`;a.click();URL.revokeObjectURL(url);
}

// â”€â”€â”€ Dooray API Sync â”€â”€â”€
const DOORAY_API="/api/dooray";
async function doorayFetch(action,params={},method="GET",body=null){
  try{
    const q=new URLSearchParams({action,...params}).toString();
    const opts={method,headers:{"Content-Type":"application/json"}};
    if(body)opts.body=JSON.stringify(body);
    const r=await fetch(`${DOORAY_API}?${q}`,opts);
    return await r.json();
  }catch(e){return{error:e.message};}
}
async function doorayList(from,to){return doorayFetch("list",{from,to});}
async function doorayCreate(ev){return doorayFetch("create",{},"POST",ev);}
async function doorayUpdate(ev){return doorayFetch("update",{},"PUT",ev);}
async function doorayDelete(id){return doorayFetch("delete",{doorayId:id},"DELETE");}
async function doorayStatus(){return doorayFetch("status");}

// â”€â”€â”€ Dooray Sync Hook â”€â”€â”€
function useDooraySync(events,setEv){
  const[dStatus,setDS]=useState(null);
  const[dLoading,setDL]=useState(false);
  const[dEvents,setDE]=useState([]);
  const[lastSync,setLS]=useState(null);
  const[dError,setDErr]=useState(null);

  const checkConn=useCallback(async()=>{
    setDL(true);
    const r=await doorayStatus();
    if(r.connected){setDS(true);setDErr(null);}
    else{setDS(false);setDErr(r.error||"ì—°ê²° ì‹¤íŒ¨");}
    setDL(false);
    return r.connected;
  },[]);

  const syncFromDooray=useCallback(async()=>{
    setDL(true);
    const today=new Date();const from=new Date(today);from.setMonth(from.getMonth()-1);
    const to=new Date(today);to.setMonth(to.getMonth()+3);
    const fmtD=d=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
    const r=await doorayList(fmtD(from),fmtD(to));
    if(r.events){setDE(r.events);setLS(new Date().toLocaleTimeString());setDErr(null);}
    else{setDErr(r.error||"ë™ê¸°í™” ì‹¤íŒ¨");}
    setDL(false);
  },[]);

  const pushToDooray=useCallback(async(ev)=>{
    const r=await doorayCreate({title:ev.title,date:ev.date,endDate:ev.endDate,time:ev.time,endTime:ev.endTime,location:ev.location,memo:ev.memo,attendees:ev.attendees});
    if(!r.error)await syncFromDooray();
    return r;
  },[syncFromDooray]);

  useEffect(()=>{
    checkConn().then(ok=>{if(ok)syncFromDooray();});
    const interval=setInterval(()=>{if(dStatus)syncFromDooray();},60000);
    return()=>clearInterval(interval);
  },[]);

  return{dStatus,dLoading,dEvents,lastSync,dError,checkConn,syncFromDooray,pushToDooray};
}

// â”€â”€â”€ Contact Picker API â”€â”€â”€
async function pickPhoneContacts(){
  if(!('contacts' in navigator && 'ContactsManager' in window)){
    alert("ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ì—°ë½ì²˜ ì—°ë™ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\nğŸ“± ì•ˆë“œë¡œì´ë“œ Chrome ë¸Œë¼ìš°ì €ì—ì„œë§Œ ì§€ì›ë©ë‹ˆë‹¤.\n\niPhoneì€ Safari ì œí•œìœ¼ë¡œ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    return null;
  }
  try{
    const props=await navigator.contacts.getProperties();
    const supported=props;
    const contacts=await navigator.contacts.select(
      supported.filter(p=>['name','tel','email'].includes(p)),
      {multiple:true}
    );
    return contacts.map(c=>({
      id:uid(),
      name:(c.name&&c.name[0])||"",
      phone:(c.tel&&c.tel[0])||"",
      email:(c.email&&c.email[0])||"",
      company:"",position:"",notes:"ğŸ“± íœ´ëŒ€í°ì—ì„œ ê°€ì ¸ì˜´"
    })).filter(c=>c.name);
  }catch(e){
    if(e.name!=='TypeError')console.error(e);
    return null;
  }
}

// â”€â”€â”€ Shared View (for recipients) â”€â”€â”€
function SharedView({data}){
  const[copied,setCopied]=useState(false);
  const lines=[];
  if(data.t)lines.push(`ğŸ“Œ ${data.t}`);
  if(data.d)lines.push(`ğŸ“… ë‚ ì§œ: ${data.d}${data.ed?` ~ ${data.ed}`:""}`);
  if(data.tm)lines.push(`â° ì‹œê°„: ${data.tm}${data.et?` - ${data.et}`:""}`);
  if(data.l)lines.push(`ğŸ“ ì¥ì†Œ: ${data.l}`);
  if(data.c)lines.push(`ğŸ¢ íšŒì‚¬: ${data.c}`);
  if(data.a)lines.push(`ğŸ‘¥ ì°¸ì„ì: ${data.a}`);
  if(data.cat&&CAT[data.cat])lines.push(`ğŸ“‚ ì¹´í…Œê³ ë¦¬: ${CAT[data.cat].l}`);
  if(data.m)lines.push(`\nğŸ“ ë‚´ìš©:\n${data.m}`);
  if(data.dec)lines.push(`\nâœ… ê²°ì •ì‚¬í•­:\n${data.dec}`);
  if(data.act)lines.push(`\nğŸ¯ Action Items:\n${data.act}`);
  const text=lines.join("\n");
  const copyAll=async()=>{try{await navigator.clipboard.writeText(text);setCopied(true);setTimeout(()=>setCopied(false),2000);}catch{}};

  return(
    <div style={{minHeight:"100vh",background:"linear-gradient(180deg,#0F172A 0%,#1E293B 30%,#F1F5F9 30.1%)",padding:"0 16px"}}>
      <div style={{maxWidth:560,margin:"0 auto",paddingTop:20,paddingBottom:40}}>
        <div style={{textAlign:"center",padding:"24px 0 36px",color:"#fff"}}>
          <div style={{fontSize:36,marginBottom:8}}>ğŸ“…</div>
          <div style={{fontWeight:800,fontSize:22,letterSpacing:"-0.5px"}}>BizPlanner</div>
          <div style={{fontSize:11,color:"#94A3B8",fontWeight:600,letterSpacing:2,marginTop:2}}>ê³µìœ ëœ ì¼ì • ì •ë³´</div>
        </div>
        <div style={{background:"#fff",borderRadius:20,padding:"28px 24px",boxShadow:"0 8px 40px rgba(0,0,0,0.1)",animation:"slideUp 0.5s ease"}}>
          {data.type&&MT[data.type]&&<div style={{display:"inline-block",fontSize:11,background:MT[data.type].color+"18",color:MT[data.type].color,borderRadius:20,padding:"4px 12px",fontWeight:700,marginBottom:14}}>{MT[data.type].icon} {MT[data.type].label}</div>}
          {data.t&&<h1 style={{fontSize:22,fontWeight:800,color:"#0F172A",marginBottom:16,lineHeight:1.4}}>{data.t}</h1>}
          <div style={{display:"flex",flexDirection:"column",gap:10}}>
            {data.d&&<div style={{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",background:"#F8FAFC",borderRadius:12}}>
              <span style={{fontSize:18}}>ğŸ“…</span><div><div style={{fontSize:10,color:"#94A3B8",fontWeight:600}}>ë‚ ì§œ</div><div style={{fontSize:15,fontWeight:600,color:"#1E293B"}}>{data.d}{data.ed?` ~ ${data.ed}`:""}</div></div></div>}
            {data.tm&&<div style={{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",background:"#F8FAFC",borderRadius:12}}>
              <span style={{fontSize:18}}>â°</span><div><div style={{fontSize:10,color:"#94A3B8",fontWeight:600}}>ì‹œê°„</div><div style={{fontSize:15,fontWeight:600,color:"#1E293B"}}>{data.tm}{data.et?` - ${data.et}`:""}</div></div></div>}
            {data.l&&<div style={{display:"flex",alignItems:"center",gap:10,padding:"10px 14px",background:"#F8FAFC",borderRadius:12}}>
              <span style={{fontSize:18}}>ğŸ“</span><div><div style={{fontSize:10,color:"#94A3B8",fontWeight:600}}>ì¥ì†Œ</div><div style={{fontSize:15,fontWeight:600,color:"#1E293B"}}>{data.l}</div></div></div>}
          </div>
          {data.m&&<div style={{marginTop:16,padding:"14px 16px",background:"#FAFBFD",borderRadius:12,borderLeft:"4px solid #3B82F6"}}>
            <div style={{fontSize:11,fontWeight:700,color:"#94A3B8",marginBottom:6}}>ğŸ“ ë‚´ìš©</div>
            <div style={{fontSize:14,color:"#334155",lineHeight:1.8,whiteSpace:"pre-wrap"}}>{data.m}</div></div>}
          <button onClick={copyAll} style={{width:"100%",marginTop:20,padding:"14px 0",borderRadius:12,border:"none",background:copied?"#10B981":"linear-gradient(135deg,#1E293B,#334155)",color:"#fff",fontWeight:700,fontSize:15,cursor:"pointer"}}>{copied?"âœ“ ë³µì‚¬ë¨":"ğŸ“‹ ì „ì²´ ë‚´ìš© ë³µì‚¬"}</button>
        </div>
      </div>
    </div>
  );
}

// â”€â”€â”€ Notification â”€â”€â”€
function reqNotif(){try{if("Notification"in window&&Notification.permission==="default")Notification.requestPermission();}catch{}}
function showNotif(t,b){try{if("Notification"in window&&Notification.permission==="granted")new Notification(t,{body:b});}catch{}}

// â”€â”€â”€ Confirm Dialog â”€â”€â”€
function Confirm({message,onOk,onNo}){
  return(<div style={ovS} onClick={onNo}><div style={{background:"#fff",borderRadius:16,padding:24,width:"100%",maxWidth:360,boxShadow:"0 20px 60px rgba(0,0,0,0.25)",animation:"slideUp 0.2s ease"}} onClick={e=>e.stopPropagation()}>
    <div style={{fontSize:15,fontWeight:600,color:"#1E293B",marginBottom:6}}>âš ï¸ í™•ì¸</div>
    <div style={{fontSize:14,color:"#64748B",marginBottom:20,lineHeight:1.6}}>{message}</div>
    <div style={{display:"flex",gap:8,justifyContent:"flex-end"}}>
      <button onClick={onNo} style={{...bS,background:"#F1F5F9",color:"#64748B"}}>ì·¨ì†Œ</button>
      <button onClick={onOk} style={{...bS,background:"#DC2626",color:"#fff"}}>ì‚­ì œ</button>
    </div>
  </div></div>);
}

// â”€â”€â”€ Contact Picker â”€â”€â”€
function CPicker({contacts,value,onChange,onAdd}){
  const[open,setOpen]=useState(false);const[q,setQ]=useState("");const ref=useRef(null);
  useEffect(()=>{const h=e=>{if(ref.current&&!ref.current.contains(e.target))setOpen(false);};document.addEventListener("mousedown",h);return()=>document.removeEventListener("mousedown",h);},[]);
  const fl=contacts.filter(c=>c.name.toLowerCase().includes(q.toLowerCase())||c.company?.toLowerCase().includes(q.toLowerCase()));
  return(<div ref={ref} style={{position:"relative"}}>
    <input value={value} onChange={e=>onChange(e.target.value)} onFocus={()=>setOpen(true)} placeholder="ğŸ‘¥ ì°¸ì„ì" style={iS}/>
    {open&&<div style={{position:"absolute",top:"100%",left:0,right:0,background:"#fff",borderRadius:12,boxShadow:"0 8px 32px rgba(0,0,0,0.15)",zIndex:50,maxHeight:200,overflow:"auto",marginTop:4,border:"1px solid #E2E8F0"}}>
      <div style={{padding:"6px 10px",borderBottom:"1px solid #F1F5F9"}}><input value={q} onChange={e=>setQ(e.target.value)} placeholder="ê²€ìƒ‰..." style={{...iS,padding:"6px 10px",fontSize:13}}/></div>
      {fl.map(c=><div key={c.id} onClick={()=>{onChange(value?value+", "+c.name:c.name);setOpen(false);setQ("");}} style={{padding:"8px 14px",cursor:"pointer",fontSize:13}} onMouseEnter={e=>e.currentTarget.style.background="#F1F5F9"} onMouseLeave={e=>e.currentTarget.style.background="transparent"}>
        <div style={{fontWeight:600,color:"#1E293B"}}>{c.name}</div><div style={{fontSize:11,color:"#94A3B8"}}>{c.company}{c.phone?` Â· ${c.phone}`:""}</div></div>)}
      <div onClick={()=>{onAdd();setOpen(false);}} style={{padding:"8px 14px",cursor:"pointer",color:"#3B82F6",fontWeight:600,fontSize:13,borderTop:"1px solid #E2E8F0"}}>+ ìƒˆ ì—°ë½ì²˜</div>
    </div>}
  </div>);
}

// â”€â”€â”€ Company AC â”€â”€â”€
function CoAC({contacts,value,onChange}){
  const[open,setOpen]=useState(false);
  const cos=[...new Set(contacts.map(c=>c.company).filter(Boolean))];
  const fl=cos.filter(c=>c.toLowerCase().includes(value.toLowerCase()));
  return(<div style={{position:"relative"}}>
    <input value={value} onChange={e=>{onChange(e.target.value);setOpen(true);}} onFocus={()=>setOpen(true)} onBlur={()=>setTimeout(()=>setOpen(false),200)} placeholder="ğŸ¢ íšŒì‚¬ëª…" style={iS}/>
    {open&&fl.length>0&&value&&<div style={{position:"absolute",top:"100%",left:0,right:0,background:"#fff",borderRadius:8,boxShadow:"0 4px 16px rgba(0,0,0,0.12)",zIndex:40,maxHeight:130,overflow:"auto",marginTop:2}}>
      {fl.map(c=><div key={c} onClick={()=>{onChange(c);setOpen(false);}} style={{padding:"8px 14px",cursor:"pointer",fontSize:13,color:"#334155"}} onMouseEnter={e=>e.currentTarget.style.background="#F1F5F9"} onMouseLeave={e=>e.currentTarget.style.background="transparent"}>ğŸ¢ {c}</div>)}
    </div>}
  </div>);
}

// â”€â”€â”€ Countdown â”€â”€â”€
function Countdown({events}){
  const[now,setNow]=useState(new Date());
  useEffect(()=>{const t=setInterval(()=>setNow(new Date()),1000);return()=>clearInterval(t);},[]);
  const up=events.filter(e=>e.alarm!=null&&e.alarm>=0&&e.date&&e.time).map(e=>{
    const[h,m]=e.time.split(":").map(Number);const et=new Date(pD(e.date));et.setHours(h,m,0,0);
    const at=new Date(et.getTime()-(e.alarm||0)*6e4);const diff=at-now;return{...e,diff};
  }).filter(e=>e.diff>-3e5&&e.diff<864e5*2).sort((a,b)=>a.diff-b.diff).slice(0,3);
  useEffect(()=>{up.forEach(e=>{if(e.diff<=0&&e.diff>-2000)showNotif(`â° ${e.title}`,`${e.date} ${e.time}`);});},[now]);
  if(!up.length)return null;
  const fc=ms=>{if(ms<=0)return"ì§€ê¸ˆ!";const h=Math.floor(ms/36e5),m=Math.floor(ms%36e5/6e4),s=Math.floor(ms%6e4/1e3);return h>0?`${h}ì‹œê°„ ${m}ë¶„`:m>0?`${m}ë¶„ ${s}ì´ˆ`:`${s}ì´ˆ`;};
  return(<div style={{background:"linear-gradient(135deg,#0F172A,#1E3A5F)",borderRadius:16,padding:"14px 16px",marginBottom:14}}>
    <div style={{fontSize:10,fontWeight:700,color:"#94A3B8",marginBottom:10,letterSpacing:1.5}}>â° COUNTDOWN</div>
    <div style={{display:"flex",flexDirection:"column",gap:8}}>
      {up.map(e=><div key={e.id} style={{display:"flex",alignItems:"center",gap:10,background:"rgba(255,255,255,0.06)",borderRadius:10,padding:"10px 12px"}}>
        <span style={{fontSize:18}}>{CAT[e.category]?.i||"ğŸ“…"}</span>
        <div style={{flex:1}}><div style={{fontSize:13,fontWeight:600,color:"#F1F5F9"}}>{e.title}</div><div style={{fontSize:11,color:"#94A3B8"}}>{e.date} {e.time}</div></div>
        <div style={{background:e.diff<=0?"#EF4444":e.diff<6e5?"#F97316":"#3B82F6",color:"#fff",padding:"4px 10px",borderRadius:20,fontSize:12,fontWeight:700,animation:e.diff<=6e4?"pulse 1s infinite":"none",minWidth:56,textAlign:"center"}}>{fc(e.diff)}</div>
      </div>)}
    </div>
  </div>);
}

// â”€â”€â”€ Dashboard â”€â”€â”€
function Dash({events,todos}){
  const te=events.filter(e=>{const dates=eventDates(e);return dates.includes(TODAY);}).length;
  const ut=todos.filter(t=>!t.completed&&t.priority==="high").length;
  const od=todos.filter(t=>!t.completed&&t.dueDate&&t.dueDate<TODAY).length;
  const we=events.filter(e=>{const d=dBtw(TODAY,e.date);return d>=0&&d<=7;}).length;
  return(<div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8,marginBottom:14}}>
    {[{i:"ğŸ“…",l:"ì˜¤ëŠ˜",v:te,c:"#3B82F6",b:"#EFF6FF"},{i:"ğŸ“†",l:"ì´ë²ˆ ì£¼",v:we,c:"#8B5CF6",b:"#F5F3FF"},{i:"ğŸ”¥",l:"ê¸´ê¸‰",v:ut,c:"#EF4444",b:"#FEF2F2"},{i:"âš ï¸",l:"ì´ˆê³¼",v:od,c:"#F97316",b:"#FFF7ED"}].map(x=>
    <div key={x.l} style={{background:x.b,borderRadius:12,padding:"10px 6px",textAlign:"center"}}>
      <div style={{fontSize:14}}>{x.i}</div><div style={{fontSize:18,fontWeight:800,color:x.c,margin:"1px 0"}}>{x.v}</div><div style={{fontSize:9,color:"#64748B",fontWeight:600}}>{x.l}</div>
    </div>)}
  </div>);
}

// â”€â”€â”€ Share Modal â”€â”€â”€
function ShareM({item,onClose,baseUrl}){
  const[cp1,setCp1]=useState(false);const[cp2,setCp2]=useState(false);
  const shareHash=encodeShare(item);
  const shareUrl=`${baseUrl}#s=${shareHash}`;
  const txt=`[BizPlanner] ${item.title||""}\n${item.date?`ğŸ“… ${item.date}${item.endDate?` ~ ${item.endDate}`:""}`:""}\n${item.time?`â° ${item.time}${item.endTime?` - ${item.endTime}`:""}`:""}\n${item.location?`ğŸ“ ${item.location}\n`:""}${item.attendees?`ğŸ‘¥ ${item.attendees}\n`:""}${item.memo||item.content||item.decisions||""}`.trim();
  const copy=async(t,fn)=>{try{await navigator.clipboard.writeText(t);fn(true);setTimeout(()=>fn(false),2000);}catch{}};
  return(<div style={ovS} onClick={onClose}><div style={{...mS,maxWidth:420,animation:"slideUp 0.25s ease"}} onClick={e=>e.stopPropagation()}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18}}>
      <h3 style={{margin:0,fontSize:18,fontWeight:700,color:"#1E293B"}}>ê³µìœ í•˜ê¸°</h3><button onClick={onClose} style={clS}>âœ•</button></div>
    <div style={{background:"linear-gradient(135deg,#EFF6FF,#F0F9FF)",borderRadius:14,padding:16,marginBottom:14,border:"1px solid #BFDBFE"}}>
      <div style={{fontSize:13,fontWeight:700,color:"#1E293B",marginBottom:4}}>ğŸ”— ê³µìœ  ë§í¬</div>
      <div style={{display:"flex",gap:6}}>
        <input value={shareUrl} readOnly style={{...iS,flex:1,fontSize:11,padding:"8px 10px",background:"#fff"}} onClick={e=>e.target.select()}/>
        <button onClick={()=>copy(shareUrl,setCp1)} style={{...bS,padding:"8px 14px",background:cp1?"#10B981":"#2563EB",color:"#fff",fontSize:12,whiteSpace:"nowrap",minWidth:70}}>{cp1?"âœ“":"ë§í¬ ë³µì‚¬"}</button>
      </div>
    </div>
    <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:6,marginBottom:14}}>
      <button onClick={()=>window.open(`sms:?body=${encodeURIComponent(txt+"\n\nğŸ”— "+shareUrl)}`)} style={{padding:"10px 4px",borderRadius:12,border:"none",background:"#4CAF50",color:"#fff",fontWeight:700,fontSize:12,cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:3}}><span style={{fontSize:18}}>ğŸ“±</span>ë¬¸ì</button>
      <button onClick={()=>window.open(`mailto:?subject=${encodeURIComponent(item.title||"BizPlanner")}&body=${encodeURIComponent(txt+"\n\nğŸ”— "+shareUrl)}`)} style={{padding:"10px 4px",borderRadius:12,border:"none",background:"#EA4335",color:"#fff",fontWeight:700,fontSize:12,cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:3}}><span style={{fontSize:18}}>ğŸ“§</span>ì´ë©”ì¼</button>
      <button onClick={()=>copy(txt+"\n\nğŸ”— "+shareUrl,setCp2)} style={{padding:"10px 4px",borderRadius:12,border:"none",background:cp2?"#10B981":"#1E293B",color:"#fff",fontWeight:700,fontSize:12,cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:3}}><span style={{fontSize:18}}>ğŸ“‹</span>{cp2?"ë³µì‚¬ë¨":"ë³µì‚¬"}</button>
      {item.date&&<button onClick={()=>downloadICS(item)} style={{padding:"10px 4px",borderRadius:12,border:"none",background:"#0284C7",color:"#fff",fontWeight:700,fontSize:12,cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:3}}><span style={{fontSize:18}}>ğŸ“…</span>ICS</button>}
    </div>
    <div style={{background:"#F8FAFC",borderRadius:10,padding:12}}>
      <div style={{fontSize:11,fontWeight:600,color:"#94A3B8",marginBottom:6}}>ë¯¸ë¦¬ë³´ê¸°</div>
      <pre style={{fontSize:12,color:"#475569",whiteSpace:"pre-wrap",margin:0,lineHeight:1.5,maxHeight:100,overflow:"auto"}}>{txt}</pre>
    </div>
  </div></div>);
}

// â”€â”€â”€ Settings â”€â”€â”€
function Settings({onClose,events,todos,memos,contacts,onRestore,dooray}){
  const fR=useRef(null);
  const exp=()=>{const d=JSON.stringify({events,todos,memos,contacts,exportDate:new Date().toISOString()},null,2);const b=new Blob([d],{type:"application/json"});const u=URL.createObjectURL(b);const a=document.createElement("a");a.href=u;a.download=`BizPlanner_${TODAY}.json`;a.click();URL.revokeObjectURL(u);};
  const imp=async e=>{const f=e.target.files[0];if(!f)return;try{const t=await f.text();const d=JSON.parse(t);if(d.events&&d.todos){onRestore(d);alert("âœ… ë³µì› ì™„ë£Œ!");}else alert("ì˜¬ë°”ë¥¸ ë°±ì—… íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.");}catch{alert("íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");}};
  return(<div style={ovS} onClick={onClose}><div style={{...mS,maxWidth:400,animation:"slideUp 0.25s ease"}} onClick={e=>e.stopPropagation()}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18}}>
      <h3 style={{margin:0,fontSize:18,fontWeight:700,color:"#1E293B"}}>âš™ï¸ ì„¤ì •</h3><button onClick={onClose} style={clS}>âœ•</button></div>
    <div style={{display:"flex",flexDirection:"column",gap:12}}>
      {/* Dooray status */}
      <div style={{background:dooray?.dStatus?"linear-gradient(135deg,#ECFDF5,#F0FDF4)":"linear-gradient(135deg,#FEF2F2,#FFF1F2)",borderRadius:12,padding:14,border:`1px solid ${dooray?.dStatus?"#86EFAC":"#FECACA"}`}}>
        <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:6}}>
          <div style={{fontSize:13,fontWeight:700,color:dooray?.dStatus?"#059669":"#DC2626"}}>{dooray?.dStatus?"ğŸ”— ë‘ë ˆì´ ì—°ê²°ë¨":"âš ï¸ ë‘ë ˆì´ ë¯¸ì—°ê²°"}</div>
          <button onClick={()=>dooray?.checkConn()} style={{fontSize:10,padding:"3px 8px",borderRadius:6,border:"1px solid #E2E8F0",background:"#fff",color:"#64748B",fontWeight:600,cursor:"pointer"}}>{dooray?.dLoading?"í™•ì¸ì¤‘...":"ì—°ê²° í™•ì¸"}</button>
        </div>
        {dooray?.dStatus?<div style={{fontSize:11,color:"#64748B"}}>
          <div>ğŸ“… ë‘ë ˆì´ ì¼ì •: <b style={{color:"#059669"}}>{dooray.dEvents.length}ê±´</b></div>
          {dooray.lastSync&&<div>â° ë§ˆì§€ë§‰ ë™ê¸°í™”: {dooray.lastSync}</div>}
          <button onClick={()=>dooray.syncFromDooray()} style={{...bS,background:"#059669",color:"#fff",width:"100%",padding:"8px 0",marginTop:6,fontSize:12}}>ğŸ”„ ì§€ê¸ˆ ë™ê¸°í™”</button>
        </div>:<div style={{fontSize:11,color:"#64748B",lineHeight:1.7}}>
          {dooray?.dError&&<div style={{color:"#DC2626",marginBottom:4}}>âŒ {dooray.dError}</div>}
          Vercel í™˜ê²½ë³€ìˆ˜ì— ë‘ë ˆì´ API í‚¤ë¥¼ ì„¤ì •í•˜ì„¸ìš”
        </div>}
      </div>
      <div style={{background:"#F8FAFC",borderRadius:12,padding:14}}>
        <div style={{fontSize:13,fontWeight:700,color:"#1E293B",marginBottom:8}}>ğŸ“Š ë°ì´í„° í˜„í™©</div>
        <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:8}}>
          {[{l:"ì¼ì •",v:events.length,c:"#3B82F6"},{l:"í• ì¼",v:todos.length,c:"#10B981"},{l:"ë©”ëª¨",v:memos.length,c:"#F59E0B"},{l:"ì—°ë½ì²˜",v:contacts.length,c:"#8B5CF6"}].map(s=>
            <div key={s.l} style={{textAlign:"center"}}><div style={{fontSize:17,fontWeight:800,color:s.c}}>{s.v}</div><div style={{fontSize:10,color:"#94A3B8"}}>{s.l}</div></div>)}
        </div>
      </div>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
        <button onClick={exp} style={{...bS,background:"#1E293B",color:"#fff",width:"100%",padding:"10px 0"}}>ğŸ“¥ ë°±ì—…</button>
        <div><button onClick={()=>fR.current?.click()} style={{...bS,background:"#3B82F6",color:"#fff",width:"100%",padding:"10px 0"}}>ğŸ“‚ ë³µì›</button>
        <input ref={fR} type="file" accept=".json" onChange={imp} style={{display:"none"}}/></div>
      </div>
      {events.length>0&&<button onClick={()=>downloadAllICS(events)} style={{...bS,background:"linear-gradient(135deg,#0284C7,#0369A1)",color:"#fff",width:"100%",padding:"10px 0"}}>ğŸ“… ì „ì²´ ICS ë‚´ë³´ë‚´ê¸°</button>}
    </div>
  </div></div>);
}

// â”€â”€â”€ Calendar with Multi-day bars & Holidays â”€â”€â”€
function Cal({cd,sd,onSel,events,onMo,onTd,onEvClick}){
  const yr=cd.getFullYear(),mo=cd.getMonth();
  const fd=new Date(yr,mo,1).getDay();const dim=new Date(yr,mo+1,0).getDate();

  // Build event-per-day map including multi-day
  const ed={};
  events.forEach(e=>{
    const dates=eventDates(e);
    dates.forEach(d=>{if(!ed[d])ed[d]=[];ed[d].push(e);});
  });

  // Multi-day events for bar rendering
  const multiDayEvs=events.filter(e=>e.endDate&&e.endDate!==e.date);

  const cells=[];for(let i=0;i<fd;i++)cells.push(null);for(let d=1;d<=dim;d++)cells.push(d);

  // Calculate multi-day bar positions
  const bars=[];
  const COLORS=["#3B82F6","#8B5CF6","#10B981","#F59E0B","#EF4444","#EC4899","#0EA5E9"];
  multiDayEvs.forEach((e,idx)=>{
    const sDate=pD(e.date);const eDate=pD(e.endDate);
    // For each week row that overlaps
    let cur=new Date(Math.max(sDate, new Date(yr,mo,1)));
    const mEnd=new Date(yr,mo,dim);
    if(cur>mEnd||eDate<new Date(yr,mo,1))return;

    const startCell=fd;// offset
    while(cur<=eDate&&cur<=mEnd){
      const day=cur.getDate();
      const cellIdx=fd+day-1;
      const row=Math.floor(cellIdx/7);
      const col=cellIdx%7;
      // Find end of this bar segment (end of week or end of event)
      let segEnd=new Date(cur);
      while(segEnd<=eDate&&segEnd<=mEnd&&segEnd.getDay()!==6){segEnd.setDate(segEnd.getDate()+1);}
      if(segEnd>eDate)segEnd=new Date(eDate);
      if(segEnd>mEnd)segEnd=new Date(mEnd);
      const endCol=fd+segEnd.getDate()-1;
      const span=(endCol%7)-col+1;
      bars.push({ev:e,row,col,span,color:COLORS[idx%COLORS.length],label:e.title});
      cur=new Date(segEnd);cur.setDate(cur.getDate()+1);
    }
  });

  return(<div style={{background:"#fff",borderRadius:16,padding:"14px 12px",boxShadow:"0 1px 4px rgba(0,0,0,0.05)"}}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}}>
      <button onClick={()=>onMo(-1)} style={nS}>â—‚</button>
      <div style={{display:"flex",alignItems:"center",gap:8}}><span style={{fontWeight:800,fontSize:16,color:"#1E293B"}}>{yr}ë…„ {MOS[mo]}</span>
        <button onClick={onTd} style={{fontSize:10,padding:"2px 8px",borderRadius:6,border:"1px solid #E2E8F0",background:"#F8FAFC",color:"#3B82F6",fontWeight:700,cursor:"pointer"}}>ì˜¤ëŠ˜</button></div>
      <button onClick={()=>onMo(1)} style={nS}>â–¸</button>
    </div>
    <div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:1,textAlign:"center"}}>
      {DAYS.map((d,i)=><div key={d} style={{fontSize:11,fontWeight:700,color:i===0?"#EF4444":i===6?"#3B82F6":"#94A3B8",padding:"3px 0"}}>{d}</div>)}
      {cells.map((day,i)=>{if(!day)return<div key={`e${i}`}/>;
        const ds=fmt(new Date(yr,mo,day)),isT=ds===TODAY,isS=ds===sd;
        const de=ed[ds]||[];const ci=i%7;
        const hol=HOLIDAYS[ds];
        const isHol=!!hol||ci===0;
        // Check multi-day bars on this cell
        const hasBar=multiDayEvs.some(e=>{const dates=eventDates(e);return dates.includes(ds);});

        return(<button key={i} onClick={()=>onSel(ds)} title={hol||""} style={{position:"relative",border:"none",borderRadius:10,padding:"5px 2px 14px",cursor:"pointer",background:isS?"#1E293B":isT?"#EFF6FF":"transparent",color:isS?"#fff":isHol?"#EF4444":ci===6?"#3B82F6":"#334155",fontWeight:isT||isS?700:400,fontSize:13,transition:"all 0.12s",minHeight:40}}>
          {day}
          {hol&&<div style={{fontSize:6,color:isS?"#FCA5A5":"#EF4444",fontWeight:700,position:"absolute",bottom:hasBar?10:2,left:0,right:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:"0 1px"}}>{hol}</div>}
          {de.length>0&&!hasBar&&<div style={{display:"flex",justifyContent:"center",gap:2,position:"absolute",bottom:2,left:0,right:0}}>{de.slice(0,3).map((ev,j)=><div key={j} style={{width:4,height:4,borderRadius:"50%",background:isS?"#fff":isEventPast(ev)?"#CBD5E1":PRI[ev.priority]?.dot||"#94A3B8"}}/>)}</div>}
          {hasBar&&<div style={{position:"absolute",bottom:2,left:1,right:1,height:4,borderRadius:2,background:"#3B82F6",opacity:isS?0.5:0.7}}/>}
        </button>);})}
    </div>
    {/* Multi-day legend */}
    {multiDayEvs.filter(e=>{const dates=eventDates(e);return dates.some(d=>{const dd=pD(d);return dd.getFullYear()===yr&&dd.getMonth()===mo;});}).length>0&&
      <div style={{marginTop:8,display:"flex",flexWrap:"wrap",gap:4}}>
        {multiDayEvs.filter(e=>{const dates=eventDates(e);return dates.some(d=>{const dd=pD(d);return dd.getFullYear()===yr&&dd.getMonth()===mo;});}).map((e,i)=>
          <div key={e.id} onClick={()=>onEvClick&&onEvClick(e)} style={{display:"flex",alignItems:"center",gap:4,fontSize:10,background:"#F8FAFC",borderRadius:6,padding:"2px 6px",cursor:"pointer"}}>
            <div style={{width:8,height:4,borderRadius:2,background:COLORS[i%COLORS.length]}}/>
            <span style={{color:"#475569",fontWeight:600}}>{e.title}</span>
            <span style={{color:"#94A3B8"}}>{e.date}~{e.endDate}</span>
          </div>)}
      </div>}
  </div>);
}

// â”€â”€â”€ Event Form (with endDate) â”€â”€â”€
function EvForm({ev,onSave,onClose,onDel,contacts,onAddC,selDate}){
  const[f,setF]=useState(ev||{id:uid(),title:"",date:selDate||TODAY,endDate:"",time:"09:00",endTime:"10:00",category:"meeting",priority:"medium",location:"",attendees:"",memo:"",alarm:15,company:""});
  const[cd,setCd]=useState(false);const u=(k,v)=>setF(p=>({...p,[k]:v}));
  return(<div style={ovS} onClick={onClose}><div style={{...mS,maxHeight:"92vh",overflow:"auto",animation:"slideUp 0.25s ease"}} onClick={e=>e.stopPropagation()}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}>
      <h3 style={{margin:0,fontSize:18,fontWeight:700,color:"#1E293B"}}>{ev?"ì¼ì • ìˆ˜ì •":"ìƒˆ ì¼ì •"}</h3><button onClick={onClose} style={clS}>âœ•</button></div>
    <div style={{display:"flex",flexDirection:"column",gap:10}}>
      <input value={f.title} onChange={e=>u("title",e.target.value)} placeholder="ğŸ“Œ ì¼ì • ì œëª© *" style={iS} autoFocus/>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
        <div><label style={lS}>ì‹œì‘ì¼</label><input type="date" value={f.date} onChange={e=>u("date",e.target.value)} style={iS}/></div>
        <div><label style={lS}>ì¢…ë£Œì¼ <span style={{color:"#94A3B8",fontWeight:400}}>(ì„ íƒ)</span></label><input type="date" value={f.endDate||""} onChange={e=>u("endDate",e.target.value)} min={f.date} style={iS}/></div>
      </div>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
        <div><label style={lS}>ì‹œì‘</label><input type="time" value={f.time} onChange={e=>u("time",e.target.value)} style={iS}/></div>
        <div><label style={lS}>ì¢…ë£Œ</label><input type="time" value={f.endTime} onChange={e=>u("endTime",e.target.value)} style={iS}/></div>
      </div>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
        <div><label style={lS}>ì¹´í…Œê³ ë¦¬</label><select value={f.category} onChange={e=>u("category",e.target.value)} style={iS}>{Object.entries(CAT).map(([k,v])=><option key={k} value={k}>{v.i} {v.l}</option>)}</select></div>
        <div><label style={lS}>â° ì•ŒëŒ</label><select value={f.alarm} onChange={e=>u("alarm",Number(e.target.value))} style={iS}><option value={-1}>ì—†ìŒ</option>{ALARMS.map(o=><option key={o.v} value={o.v}>{o.l}</option>)}</select></div>
      </div>
      <div><label style={lS}>ìš°ì„ ìˆœìœ„</label><div style={{display:"flex",gap:6}}>{[["high","ìƒ"],["medium","ì¤‘"],["low","í•˜"]].map(([k,l])=>
        <button key={k} onClick={()=>u("priority",k)} style={{flex:1,padding:"8px 0",borderRadius:8,border:f.priority===k?`2px solid ${PRI[k].dot}`:"2px solid #E2E8F0",background:f.priority===k?PRI[k].bg:"#fff",color:f.priority===k?PRI[k].text:"#64748B",fontWeight:600,fontSize:13,cursor:"pointer"}}>{l}</button>)}</div></div>
      <CoAC contacts={contacts} value={f.company||""} onChange={v=>u("company",v)}/>
      <CPicker contacts={contacts} value={f.attendees} onChange={v=>u("attendees",v)} onAdd={onAddC}/>
      <input value={f.location} onChange={e=>u("location",e.target.value)} placeholder="ğŸ“ ì¥ì†Œ" style={iS}/>
      <textarea value={f.memo} onChange={e=>u("memo",e.target.value)} placeholder="ğŸ“ ë©”ëª¨" rows={3} style={{...iS,resize:"vertical"}}/>
    </div>
    <div style={{display:"flex",gap:8,marginTop:14}}>
      {ev&&<button onClick={()=>setCd(true)} style={{...bS,background:"#FEE2E2",color:"#DC2626"}}>ì‚­ì œ</button>}
      <div style={{flex:1}}/><button onClick={onClose} style={{...bS,background:"#F1F5F9",color:"#64748B"}}>ì·¨ì†Œ</button>
      <button onClick={()=>{if(f.title.trim())onSave(f);}} style={{...bS,background:"#1E293B",color:"#fff",opacity:f.title.trim()?1:0.4}}>ì €ì¥</button></div>
    {cd&&<Confirm message={`"${ev.title}" ì‚­ì œ?`} onOk={()=>onDel(ev.id)} onNo={()=>setCd(false)}/>}
  </div></div>);
}

// â”€â”€â”€ Contact Form â”€â”€â”€
function CoForm({co,onSave,onClose,onDel}){
  const[f,setF]=useState(co||{id:uid(),name:"",company:"",phone:"",email:"",position:"",notes:""});
  const[cd,setCd]=useState(false);const u=(k,v)=>setF(p=>({...p,[k]:v}));
  return(<div style={ovS} onClick={onClose}><div style={{...mS,animation:"slideUp 0.25s ease"}} onClick={e=>e.stopPropagation()}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}>
      <h3 style={{margin:0,fontSize:18,fontWeight:700,color:"#1E293B"}}>{co?"ì—°ë½ì²˜ ìˆ˜ì •":"ìƒˆ ì—°ë½ì²˜"}</h3><button onClick={onClose} style={clS}>âœ•</button></div>
    <div style={{display:"flex",flexDirection:"column",gap:10}}>
      <input value={f.name} onChange={e=>u("name",e.target.value)} placeholder="ğŸ‘¤ ì´ë¦„ *" style={iS} autoFocus/>
      <input value={f.company} onChange={e=>u("company",e.target.value)} placeholder="ğŸ¢ íšŒì‚¬" style={iS}/>
      <input value={f.position} onChange={e=>u("position",e.target.value)} placeholder="ğŸ’¼ ì§ì±…" style={iS}/>
      <input value={f.phone} onChange={e=>u("phone",e.target.value)} placeholder="ğŸ“± ì „í™”ë²ˆí˜¸" style={iS} type="tel"/>
      <input value={f.email} onChange={e=>u("email",e.target.value)} placeholder="ğŸ“§ ì´ë©”ì¼" style={iS} type="email"/>
      <textarea value={f.notes} onChange={e=>u("notes",e.target.value)} placeholder="ğŸ“ ë©”ëª¨" rows={2} style={{...iS,resize:"vertical"}}/>
    </div>
    <div style={{display:"flex",gap:8,marginTop:14}}>
      {co&&<button onClick={()=>setCd(true)} style={{...bS,background:"#FEE2E2",color:"#DC2626"}}>ì‚­ì œ</button>}
      <div style={{flex:1}}/><button onClick={onClose} style={{...bS,background:"#F1F5F9",color:"#64748B"}}>ì·¨ì†Œ</button>
      <button onClick={()=>{if(f.name.trim())onSave(f);}} style={{...bS,background:"#1E293B",color:"#fff",opacity:f.name.trim()?1:0.4}}>ì €ì¥</button></div>
    {cd&&<Confirm message={`"${co.name}" ì‚­ì œ?`} onOk={()=>onDel(co.id)} onNo={()=>setCd(false)}/>}
  </div></div>);
}

// â”€â”€â”€ Todo Form â”€â”€â”€
function TdForm({td,onSave,onClose,onDel}){
  const[f,setF]=useState(td||{id:uid(),title:"",category:"ì—…ë¬´",priority:"medium",notes:"",completed:false,createdDate:TODAY,dueDate:""});
  const[cd,setCd]=useState(false);const u=(k,v)=>setF(p=>({...p,[k]:v}));
  return(<div style={ovS} onClick={onClose}><div style={{...mS,animation:"slideUp 0.25s ease"}} onClick={e=>e.stopPropagation()}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}>
      <h3 style={{margin:0,fontSize:18,fontWeight:700,color:"#1E293B"}}>{td?"í• ì¼ ìˆ˜ì •":"ìƒˆ í• ì¼"}</h3><button onClick={onClose} style={clS}>âœ•</button></div>
    <div style={{display:"flex",flexDirection:"column",gap:10}}>
      <input value={f.title} onChange={e=>u("title",e.target.value)} placeholder="âœ… í•  ì¼ *" style={iS} autoFocus/>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
        <div><label style={lS}>ì¹´í…Œê³ ë¦¬</label><select value={f.category} onChange={e=>u("category",e.target.value)} style={iS}>{TCATS.map(c=><option key={c}>{c}</option>)}</select></div>
        <div><label style={lS}>ğŸ“… ë§ˆê°ì¼</label><input type="date" value={f.dueDate||""} onChange={e=>u("dueDate",e.target.value)} style={iS}/></div>
      </div>
      <div><label style={lS}>ì¤‘ìš”ë„</label><div style={{display:"flex",gap:6}}>{[["high","ìƒ"],["medium","ì¤‘"],["low","í•˜"]].map(([k,l])=>
        <button key={k} onClick={()=>u("priority",k)} style={{flex:1,padding:"8px",borderRadius:8,border:f.priority===k?`2px solid ${PRI[k].dot}`:"2px solid #E2E8F0",background:f.priority===k?PRI[k].bg:"#fff",color:f.priority===k?PRI[k].text:"#64748B",fontWeight:600,fontSize:13,cursor:"pointer"}}>{l}</button>)}</div></div>
      <textarea value={f.notes} onChange={e=>u("notes",e.target.value)} placeholder="ğŸ“ ë©”ëª¨" rows={2} style={{...iS,resize:"vertical"}}/>
    </div>
    <div style={{display:"flex",gap:8,marginTop:14}}>
      {td&&<button onClick={()=>setCd(true)} style={{...bS,background:"#FEE2E2",color:"#DC2626"}}>ì‚­ì œ</button>}
      <div style={{flex:1}}/><button onClick={onClose} style={{...bS,background:"#F1F5F9",color:"#64748B"}}>ì·¨ì†Œ</button>
      <button onClick={()=>{if(f.title.trim())onSave(f);}} style={{...bS,background:"#1E293B",color:"#fff",opacity:f.title.trim()?1:0.4}}>ì €ì¥</button></div>
    {cd&&<Confirm message={`"${td.title}" ì‚­ì œ?`} onOk={()=>onDel(td.id)} onNo={()=>setCd(false)}/>}
  </div></div>);
}

// â”€â”€â”€ Memo Form â”€â”€â”€
function MeForm({me,onSave,onClose,onDel}){
  const[f,setF]=useState(me||{id:uid(),title:"",type:"free",date:TODAY,content:"",attendees:"",agenda:"",decisions:"",actionItems:"",nextMeeting:"",attachments:[],voiceNotes:[],tags:""});
  const[cd,setCd]=useState(false);const u=(k,v)=>setF(p=>({...p,[k]:v}));
  const fR=useRef(null);const cR=useRef(null);const[rec,setRec]=useState(false);const[rcr,setRcr]=useState(null);
  const hF=e=>{Array.from(e.target.files).forEach(file=>{const r=new FileReader();r.onload=ev=>{setF(p=>({...p,attachments:[...(p.attachments||[]),{id:uid(),name:file.name,size:file.size,type:file.type.startsWith("image/")?"image":"file",preview:file.type.startsWith("image/")?ev.target.result:null,dataUrl:ev.target.result}]}));};r.readAsDataURL(file);});};
  const hC=e=>{const file=e.target.files[0];if(!file)return;const r=new FileReader();r.onload=ev=>{setF(p=>({...p,attachments:[...(p.attachments||[]),{id:uid(),name:`ì‚¬ì§„_${new Date().toLocaleTimeString()}.jpg`,size:file.size,type:"image",preview:ev.target.result,dataUrl:ev.target.result}]}));};r.readAsDataURL(file);};
  const sR=async()=>{try{const s=await navigator.mediaDevices.getUserMedia({audio:true});const mr=new MediaRecorder(s);const ch=[];mr.ondataavailable=e=>ch.push(e.data);mr.onstop=()=>{const bl=new Blob(ch,{type:"audio/webm"});const r=new FileReader();r.onload=ev=>{setF(p=>({...p,voiceNotes:[...(p.voiceNotes||[]),{id:uid(),dataUrl:ev.target.result,date:new Date().toLocaleTimeString()}]}));};r.readAsDataURL(bl);s.getTracks().forEach(t=>t.stop());};mr.start();setRcr(mr);setRec(true);}catch{alert("ë§ˆì´í¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤");}};
  const eR=()=>{if(rcr){rcr.stop();setRec(false);setRcr(null);}};
  const mt=MT[f.type]||MT.free;
  return(<div style={ovS} onClick={onClose}><div style={{...mS,maxHeight:"92vh",overflow:"auto",animation:"slideUp 0.25s ease"}} onClick={e=>e.stopPropagation()}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}>
      <h3 style={{margin:0,fontSize:18,fontWeight:700,color:"#1E293B"}}>{me?"ë©”ëª¨ ìˆ˜ì •":"ìƒˆ ë©”ëª¨"}</h3><button onClick={onClose} style={clS}>âœ•</button></div>
    <div style={{display:"flex",gap:4,marginBottom:12,flexWrap:"wrap"}}>{Object.entries(MT).map(([k,v])=>
      <button key={k} onClick={()=>u("type",k)} style={{padding:"4px 10px",borderRadius:20,border:f.type===k?`2px solid ${v.color}`:"2px solid #E2E8F0",background:f.type===k?v.color+"18":"#fff",color:f.type===k?v.color:"#64748B",fontWeight:600,fontSize:11,cursor:"pointer"}}>{v.icon} {v.label}</button>)}</div>
    <div style={{display:"flex",flexDirection:"column",gap:10}}>
      <input value={f.title} onChange={e=>u("title",e.target.value)} placeholder={`${mt.icon} ì œëª© *`} style={iS} autoFocus/>
      <input type="date" value={f.date} onChange={e=>u("date",e.target.value)} style={iS}/>
      {f.type==="meeting"&&<><input value={f.attendees} onChange={e=>u("attendees",e.target.value)} placeholder="ğŸ‘¥ ì°¸ì„ì" style={iS}/>
        <textarea value={f.agenda} onChange={e=>u("agenda",e.target.value)} placeholder="ğŸ“‹ ì•ˆê±´" rows={3} style={{...iS,resize:"vertical"}}/>
        <textarea value={f.decisions} onChange={e=>u("decisions",e.target.value)} placeholder="âœ… ê²°ì •ì‚¬í•­" rows={3} style={{...iS,resize:"vertical"}}/>
        <textarea value={f.actionItems} onChange={e=>u("actionItems",e.target.value)} placeholder="ğŸ¯ Action Items" rows={3} style={{...iS,resize:"vertical"}}/>
        <input value={f.nextMeeting} onChange={e=>u("nextMeeting",e.target.value)} placeholder="ğŸ“… ë‹¤ìŒ ë¯¸íŒ…" style={iS}/></>}
      {f.type==="idea"&&<><textarea value={f.content} onChange={e=>u("content",e.target.value)} placeholder="ğŸ’¡ ì•„ì´ë””ì–´..." rows={5} style={{...iS,resize:"vertical"}}/>
        <input value={f.tags} onChange={e=>u("tags",e.target.value)} placeholder="ğŸ·ï¸ íƒœê·¸ (ì‰¼í‘œ êµ¬ë¶„)" style={iS}/></>}
      {f.type!=="meeting"&&f.type!=="idea"&&<textarea value={f.content} onChange={e=>u("content",e.target.value)} placeholder={f.type==="diary"?"ğŸ“” ì˜¤ëŠ˜ì˜ ì¼ê¸°...":"ğŸ“ ë‚´ìš©..."} rows={5} style={{...iS,resize:"vertical"}}/>}
      <div style={{background:"#F8FAFC",borderRadius:12,padding:12}}>
        <div style={{fontSize:11,fontWeight:700,color:"#64748B",marginBottom:6}}>ğŸ“ ì²¨ë¶€</div>
        <div style={{display:"flex",gap:6,flexWrap:"wrap"}}>
          <button onClick={()=>fR.current?.click()} style={aBS}>ğŸ“ íŒŒì¼</button><input ref={fR} type="file" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt" onChange={hF} style={{display:"none"}}/>
          <button onClick={()=>cR.current?.click()} style={aBS}>ğŸ“· ì´¬ì˜</button><input ref={cR} type="file" accept="image/*" capture="environment" onChange={hC} style={{display:"none"}}/>
          <button onClick={rec?eR:sR} style={{...aBS,border:rec?"2px solid #EF4444":"2px dashed #CBD5E1",background:rec?"#FEE2E2":"#fff",color:rec?"#DC2626":"#64748B",animation:rec?"pulse 1s infinite":"none"}}>ğŸ™ï¸ {rec?"ì¤‘ì§€":"ìŒì„±"}</button>
        </div>
        {(f.attachments?.length>0||f.voiceNotes?.length>0)&&<div style={{marginTop:6,display:"flex",flexDirection:"column",gap:3}}>
          {f.attachments?.map((a,i)=><div key={a.id} style={{display:"flex",alignItems:"center",gap:6,background:"#fff",borderRadius:6,padding:"4px 8px"}}>
            {a.type==="image"&&a.preview?<img src={a.preview} style={{width:24,height:24,borderRadius:4,objectFit:"cover"}} alt=""/>:<span>ğŸ“„</span>}
            <span style={{flex:1,fontSize:11,color:"#475569",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{a.name}</span>
            <button onClick={()=>u("attachments",f.attachments.filter((_,j)=>j!==i))} style={{border:"none",background:"none",color:"#94A3B8",cursor:"pointer",fontSize:12,padding:0}}>âœ•</button></div>)}
          {f.voiceNotes?.map((v,i)=><div key={v.id} style={{display:"flex",alignItems:"center",gap:6,background:"#fff",borderRadius:6,padding:"4px 8px"}}>
            <span>ğŸ™ï¸</span><span style={{flex:1,fontSize:11,color:"#475569"}}>ìŒì„± ({v.date})</span>
            <button onClick={()=>u("voiceNotes",f.voiceNotes.filter((_,j)=>j!==i))} style={{border:"none",background:"none",color:"#94A3B8",cursor:"pointer",fontSize:12,padding:0}}>âœ•</button></div>)}
        </div>}
      </div>
    </div>
    <div style={{display:"flex",gap:8,marginTop:14}}>
      {me&&<button onClick={()=>setCd(true)} style={{...bS,background:"#FEE2E2",color:"#DC2626"}}>ì‚­ì œ</button>}
      <div style={{flex:1}}/><button onClick={onClose} style={{...bS,background:"#F1F5F9",color:"#64748B"}}>ì·¨ì†Œ</button>
      <button onClick={()=>{if(f.title.trim())onSave(f);}} style={{...bS,background:"#1E293B",color:"#fff",opacity:f.title.trim()?1:0.4}}>ì €ì¥</button></div>
    {cd&&<Confirm message={`"${me.title}" ì‚­ì œ?`} onOk={()=>onDel(me.id)} onNo={()=>setCd(false)}/>}
  </div></div>);
}

// â”€â”€â”€ Event Card (with past/ongoing styling) â”€â”€â”€
function EventCard({e,onClick,onShare}){
  const past=isEventPast(e);
  const ongoing=isEventOngoing(e);
  const p=PRI[e.priority]||PRI.medium;
  const multiDay=e.endDate&&e.endDate!==e.date;
  return(
    <div className="card" onClick={onClick} style={{background:past?"#F8FAFC":"#fff",borderRadius:12,padding:"10px 12px",borderLeft:`4px solid ${past?"#CBD5E1":ongoing?"#10B981":p.dot}`,boxShadow:"0 1px 3px rgba(0,0,0,0.04)",cursor:"pointer",transition:"all 0.15s",opacity:past?0.6:1}}>
      <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:2}}>
        <span style={{fontSize:14}}>{CAT[e.category]?.i||"ğŸ“…"}</span>
        <span style={{fontWeight:600,fontSize:14,color:past?"#94A3B8":"#1E293B",flex:1,textDecoration:past?"line-through":"none"}}>{e.title}</span>
        {ongoing&&<span style={{fontSize:8,background:"#DCFCE7",color:"#16A34A",borderRadius:4,padding:"2px 5px",fontWeight:700,animation:"pulse 2s infinite"}}>ì§„í–‰ì¤‘</span>}
        {past&&<span style={{fontSize:8,background:"#F1F5F9",color:"#94A3B8",borderRadius:4,padding:"2px 5px",fontWeight:700}}>ì¢…ë£Œ</span>}
        <span style={{fontSize:11,color:past?"#CBD5E1":"#94A3B8"}}>{e.time}{e.endTime?` - ${e.endTime}`:""}</span>
        {e.alarm>=0&&!past&&<span style={{fontSize:8,background:"#DBEAFE",color:"#2563EB",borderRadius:4,padding:"1px 4px",fontWeight:600}}>â°</span>}
        {e.source==="dooray"&&<span style={{fontSize:8,background:"#DBEAFE",color:"#0284C7",borderRadius:4,padding:"1px 4px",fontWeight:700}}>ë‘ë ˆì´</span>}
        <button onClick={ev=>{ev.stopPropagation();onShare(e);}} style={{border:"none",background:"none",cursor:"pointer",fontSize:12,padding:1,color:"#94A3B8"}}>â†—ï¸</button>
      </div>
      {multiDay&&<div style={{fontSize:10,color:"#8B5CF6",marginLeft:20,fontWeight:600}}>ğŸ“… {e.date} ~ {e.endDate}</div>}
      {e.company&&<div style={{fontSize:11,color:past?"#CBD5E1":"#64748B",marginLeft:20}}>ğŸ¢ {e.company}</div>}
      {e.location&&<div style={{fontSize:11,color:past?"#CBD5E1":"#64748B",marginLeft:20}}>ğŸ“ {e.location}</div>}
      {e.attendees&&<div style={{fontSize:11,color:past?"#CBD5E1":"#64748B",marginLeft:20}}>ğŸ‘¥ {e.attendees}</div>}
    </div>
  );
}

// â•â•â•â•â•â•â• MAIN APP â•â•â•â•â•â•â•
function App(){
  const hash=window.location.hash;
  if(hash.startsWith("#s=")){const data=decodeShare(hash.slice(3));if(data)return <SharedView data={data}/>;}

  const[ev,setEv]=useState(()=>ld("bp-events",[]));const[td,setTd]=useState(()=>ld("bp-todos",[]));
  const[me,setMe]=useState(()=>ld("bp-memos",[]));const[co,setCo]=useState(()=>ld("bp-contacts",[]));
  const[tab,setTab]=useState("schedule");const[cd,setCd]=useState(new Date());const[sd,setSd]=useState(TODAY);
  const[sEF,setSEF]=useState(false);const[sTF,setSTF]=useState(false);const[sMF,setSMF]=useState(false);const[sCF,setSCF]=useState(false);
  const[eE,setEE]=useState(null);const[eT,setET]=useState(null);const[eM,setEM]=useState(null);const[eC,setEC]=useState(null);
  const[share,setShare]=useState(null);const[sSet,setSSet]=useState(false);
  const[q,setQ]=useState("");const[tF,setTF]=useState("all");const[mF,setMF]=useState("all");const[tS,setTS]=useState("priority");
  const[gS,setGS]=useState(false);
  const[now,setNow]=useState(new Date());
  const baseUrl=window.location.origin+window.location.pathname;
  const dooray=useDooraySync(ev,setEv);

  // Re-render every 30s for past/ongoing status
  useEffect(()=>{const t=setInterval(()=>setNow(new Date()),30000);return()=>clearInterval(t);},[]);
  useEffect(()=>{reqNotif();},[]);
  useEffect(()=>{const h=e=>{if(e.key==="Escape"){if(share)setShare(null);else if(sSet)setSSet(false);else if(sEF){setSEF(false);setEE(null);}else if(sTF){setSTF(false);setET(null);}else if(sMF){setSMF(false);setEM(null);}else if(sCF){setSCF(false);setEC(null);}else if(gS){setGS(false);setQ("");}}}; document.addEventListener("keydown",h);return()=>document.removeEventListener("keydown",h);},[share,sSet,sEF,sTF,sMF,sCF,gS]);

  const persist=(k,d,s)=>{s(d);sv(k,d);};
  const saveEv=e=>{persist("bp-events",eE?ev.map(x=>x.id===e.id?e:x):[...ev,e],setEv);if(dooray.dStatus&&!e.source)dooray.pushToDooray(e);setSEF(false);setEE(null);};
  const delEv=id=>{const target=ev.find(e=>e.id===id);if(target?.doorayId&&dooray.dStatus)doorayDelete(target.doorayId);persist("bp-events",ev.filter(e=>e.id!==id),setEv);setSEF(false);setEE(null);};
  const saveTd=t=>{persist("bp-todos",eT?td.map(x=>x.id===t.id?t:x):[...td,t],setTd);setSTF(false);setET(null);};
  const delTd=id=>{persist("bp-todos",td.filter(t=>t.id!==id),setTd);setSTF(false);setET(null);};
  const togTd=id=>{persist("bp-todos",td.map(t=>t.id===id?{...t,completed:!t.completed,completedDate:!t.completed?TODAY:null}:t),setTd);};
  const saveMe=m=>{persist("bp-memos",eM?me.map(x=>x.id===m.id?m:x):[...me,m],setMe);setSMF(false);setEM(null);};
  const delMe=id=>{persist("bp-memos",me.filter(m=>m.id!==id),setMe);setSMF(false);setEM(null);};
  const saveCo=c=>{persist("bp-contacts",eC?co.map(x=>x.id===c.id?c:x):[...co,c],setCo);setSCF(false);setEC(null);};
  const delCo=id=>{persist("bp-contacts",co.filter(c=>c.id!==id),setCo);setSCF(false);setEC(null);};
  const restore=d=>{sv("bp-events",d.events);sv("bp-todos",d.todos);sv("bp-memos",d.memos);sv("bp-contacts",d.contacts);setEv(d.events);setTd(d.todos);setMe(d.memos);setCo(d.contacts);setSSet(false);};

  // Import phone contacts
  const importContacts=async()=>{
    const picked=await pickPhoneContacts();
    if(!picked)return;
    const newContacts=picked.filter(p=>!co.some(c=>c.name===p.name&&c.phone===p.phone));
    if(newContacts.length===0){alert("ìƒˆë¡œ ì¶”ê°€í•  ì—°ë½ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤.");return;}
    persist("bp-contacts",[...co,...newContacts],setCo);
    alert(`âœ… ${newContacts.length}ëª…ì˜ ì—°ë½ì²˜ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!`);
  };

  const tQ=gS?"":q;
  // Merge dooray + local
  const allEv=[...ev,...dooray.dEvents.filter(de=>!ev.some(le=>le.doorayId===de.doorayId))];

  // Events for selected day (including multi-day events)
  const dayEvs=allEv.filter(e=>{const dates=eventDates(e);return dates.includes(sd);}).sort((a,b)=>(a.time||"").localeCompare(b.time||""));

  // Upcoming events: grouped by date, with past detection
  const upcomingAll=allEv.filter(e=>{
    const endD=e.endDate||e.date;
    return endD>=TODAY;
  }).sort((a,b)=>a.date.localeCompare(b.date)||(a.time||"").localeCompare(b.time||""));

  // Group by date
  const upcomingGrouped=useMemo(()=>{
    const groups={};
    upcomingAll.forEach(e=>{
      const key=e.date;
      if(!groups[key])groups[key]=[];
      groups[key].push(e);
    });
    return Object.entries(groups).slice(0,10);// max 10 date groups
  },[upcomingAll,now]);

  // Past events (recent 10)
  const pastEvs=allEv.filter(e=>isEventPast(e)).sort((a,b)=>b.date.localeCompare(a.date)||(b.time||"").localeCompare(a.time||"")).slice(0,5);

  const fTd=td.filter(t=>tF==="active"?!t.completed:tF==="completed"?t.completed:true).filter(t=>!tQ||t.title.toLowerCase().includes(tQ.toLowerCase()))
    .sort((a,b)=>{if(tS==="priority"){const o={high:0,medium:1,low:2};return(o[a.priority]||1)-(o[b.priority]||1);}if(tS==="created")return dBtw(b.createdDate,TODAY)-dBtw(a.createdDate,TODAY);if(tS==="due"){if(!a.dueDate&&!b.dueDate)return 0;if(!a.dueDate)return 1;if(!b.dueDate)return -1;return a.dueDate.localeCompare(b.dueDate);}return 0;});
  const fMe=me.filter(m=>mF!=="all"?m.type===mF:true).filter(m=>!tQ||m.title.toLowerCase().includes(tQ.toLowerCase())||m.content?.toLowerCase().includes(tQ.toLowerCase())).sort((a,b)=>b.date.localeCompare(a.date));

  const sdo=pD(sd);const dl=`${sdo.getMonth()+1}ì›” ${sdo.getDate()}ì¼ (${DAYS[sdo.getDay()]})`;
  const holToday=HOLIDAYS[sd];
  const atd=td.filter(t=>!t.completed).length;
  const gR=q&&gS?{e:allEv.filter(e=>e.title.toLowerCase().includes(q.toLowerCase())||e.location?.toLowerCase().includes(q.toLowerCase())),t:td.filter(t=>t.title.toLowerCase().includes(q.toLowerCase())),m:me.filter(m=>m.title.toLowerCase().includes(q.toLowerCase())||m.content?.toLowerCase().includes(q.toLowerCase())),c:co.filter(c=>c.name.toLowerCase().includes(q.toLowerCase())||c.company?.toLowerCase().includes(q.toLowerCase()))}:null;

  const tabs=[{k:"schedule",i:"ğŸ“…",l:"ì¼ì •"},{k:"todo",i:"âœ…",l:"í• ì¼",badge:atd},{k:"memo",i:"ğŸ“",l:"ë©”ëª¨"},{k:"contacts",i:"ğŸ‘¥",l:"ì—°ë½ì²˜"}];

  return(
    <div style={{minHeight:"100vh",background:"#F1F5F9",paddingBottom:80}}>
      {/* Header */}
      <div style={{background:"linear-gradient(135deg,#0F172A,#1E293B 60%,#1E3A5F)",color:"#fff",padding:"12px 20px",position:"sticky",top:0,zIndex:100,boxShadow:"0 2px 12px rgba(0,0,0,0.2)"}}>
        <div style={{maxWidth:900,margin:"0 auto",display:"flex",justifyContent:"space-between",alignItems:"center"}}>
          <div style={{display:"flex",alignItems:"center",gap:10}}>
            <div style={{width:32,height:32,borderRadius:10,background:"linear-gradient(135deg,#3B82F6,#8B5CF6)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16}}>ğŸ“…</div>
            <div><div style={{fontWeight:800,fontSize:15,letterSpacing:"-0.5px"}}>BizPlanner</div><div style={{fontSize:8,color:"#94A3B8",fontWeight:600,letterSpacing:1.5}}>SMART BUSINESS PLANNER</div></div>
          </div>
          <div style={{display:"flex",alignItems:"center",gap:6}}>
            {dooray.dStatus!==null&&<button onClick={()=>dooray.syncFromDooray()} title={dooray.lastSync?`ë§ˆì§€ë§‰ ë™ê¸°í™”: ${dooray.lastSync}`:"ë™ê¸°í™” ëŒ€ê¸°ì¤‘"} style={{border:"none",background:dooray.dStatus?"rgba(16,185,129,0.2)":"rgba(239,68,68,0.2)",borderRadius:8,padding:"4px 8px",cursor:"pointer",fontSize:11,color:dooray.dStatus?"#10B981":"#EF4444",fontWeight:600,display:"flex",alignItems:"center",gap:3,animation:dooray.dLoading?"pulse 1s infinite":"none"}}>
              {dooray.dLoading?"âŸ³":dooray.dStatus?"ğŸ”—":"âš ï¸"}{dooray.dStatus?" ë‘ë ˆì´":" ë¯¸ì—°ê²°"}
            </button>}
            <button onClick={()=>setSSet(true)} style={{border:"none",background:"rgba(255,255,255,0.1)",borderRadius:8,padding:"6px 8px",cursor:"pointer",fontSize:13,color:"#94A3B8"}}>âš™ï¸</button>
          </div>
        </div>
      </div>

      <div style={{maxWidth:900,margin:"0 auto",padding:"0 14px"}}>
        {/* Search */}
        <div style={{margin:"10px 0 0",position:"relative"}}>
          <input value={q} onChange={e=>{setQ(e.target.value);setGS(!!e.target.value);}} placeholder="ğŸ” ì „ì²´ ê²€ìƒ‰..." style={{...iS,background:"#fff",borderRadius:12,paddingRight:40,boxShadow:"0 1px 3px rgba(0,0,0,0.04)"}}/>
          {q&&<button onClick={()=>{setQ("");setGS(false);}} style={{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",border:"none",background:"none",color:"#94A3B8",cursor:"pointer",fontSize:15}}>âœ•</button>}
        </div>

        {gR&&(gR.e.length+gR.t.length+gR.m.length+gR.c.length)>0&&<div style={{background:"#fff",borderRadius:12,marginTop:6,padding:12,boxShadow:"0 2px 8px rgba(0,0,0,0.06)",maxHeight:280,overflow:"auto"}}>
          <div style={{fontSize:11,fontWeight:700,color:"#94A3B8",marginBottom:6}}>ê²€ìƒ‰ ê²°ê³¼ ({gR.e.length+gR.t.length+gR.m.length+gR.c.length}ê±´)</div>
          {gR.e.map(e=><div key={e.id} className="sr" onClick={()=>{setEE(e);setSEF(true);setGS(false);setQ("");}} style={srS}><span>{CAT[e.category]?.i||"ğŸ“…"}</span><span style={{flex:1,fontWeight:600}}>{e.title}</span><span style={{fontSize:11,color:"#94A3B8"}}>{e.date}</span></div>)}
          {gR.t.map(t=><div key={t.id} className="sr" onClick={()=>{setET(t);setSTF(true);setGS(false);setQ("");}} style={srS}><span>âœ…</span><span style={{flex:1,fontWeight:600}}>{t.title}</span><span style={{fontSize:10,background:PRI[t.priority]?.bg,color:PRI[t.priority]?.text,borderRadius:4,padding:"1px 4px"}}>{PRI[t.priority]?.label}</span></div>)}
          {gR.m.map(m=><div key={m.id} className="sr" onClick={()=>{setEM(m);setSMF(true);setGS(false);setQ("");}} style={srS}><span>{MT[m.type]?.icon||"ğŸ“"}</span><span style={{flex:1,fontWeight:600}}>{m.title}</span><span style={{fontSize:11,color:"#94A3B8"}}>{m.date}</span></div>)}
          {gR.c.map(c=><div key={c.id} className="sr" onClick={()=>{setEC(c);setSCF(true);setGS(false);setQ("");}} style={srS}><span>ğŸ‘¤</span><span style={{flex:1,fontWeight:600}}>{c.name}</span><span style={{fontSize:11,color:"#94A3B8"}}>{c.company}</span></div>)}
        </div>}

        {/* Tabs */}
        <div style={{display:"flex",gap:3,background:"#E2E8F0",borderRadius:14,padding:3,margin:"8px 0"}}>
          {tabs.map(t=><button key={t.k} onClick={()=>{setTab(t.k);setQ("");setGS(false);}} style={{flex:1,padding:"8px 0",borderRadius:11,border:"none",background:tab===t.k?"#fff":"transparent",color:tab===t.k?"#1E293B":"#64748B",fontWeight:tab===t.k?700:500,fontSize:13,cursor:"pointer",transition:"all 0.2s",boxShadow:tab===t.k?"0 1px 4px rgba(0,0,0,0.08)":"none",display:"flex",alignItems:"center",justifyContent:"center",gap:4}}>
            <span>{t.i}</span>{t.l}{t.badge>0&&<span style={{background:"#EF4444",color:"#fff",fontSize:10,fontWeight:700,borderRadius:10,padding:"1px 5px"}}>{t.badge}</span>}
          </button>)}
        </div>

        {/* SCHEDULE */}
        {tab==="schedule"&&<><Dash events={allEv} todos={td}/><Countdown events={allEv}/>
          <Cal cd={cd} sd={sd} onSel={setSd} events={allEv} onMo={d=>{const n=new Date(cd);n.setMonth(n.getMonth()+d);setCd(n);}} onTd={()=>{setCd(new Date());setSd(TODAY);}} onEvClick={e=>{setEE(e);setSEF(true);}}/>

          {/* Selected day events */}
          <div style={{marginTop:14}}>
            <h3 style={{margin:"0 0 8px",fontSize:15,fontWeight:700,color:"#1E293B"}}>
              {dl}
              {holToday&&<span style={{fontSize:12,color:"#EF4444",fontWeight:600,marginLeft:6}}>ğŸŒ {holToday}</span>}
              {dayEvs.length>0&&<span style={{fontSize:12,color:"#94A3B8",fontWeight:400}}> ({dayEvs.length}ê±´)</span>}
            </h3>
            {dayEvs.length===0?<div style={{textAlign:"center",padding:"24px 0",color:"#94A3B8"}}><div style={{fontSize:26,marginBottom:4}}>{holToday?"ğŸ‰":"ğŸŒ¤"}</div><div style={{fontSize:13}}>{holToday?`${holToday} ğŸŠ`:"ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤"}</div>
              {(()=>{const nx=allEv.filter(e=>e.date>sd).sort((a,b)=>a.date.localeCompare(b.date))[0];return nx?<div style={{fontSize:11,marginTop:6,color:"#3B82F6",cursor:"pointer"}} onClick={()=>setSd(nx.date)}>ë‹¤ìŒ: {nx.date} â€” {nx.title} â†’</div>:null;})()}</div>
            :<div style={{display:"flex",flexDirection:"column",gap:6}}>{dayEvs.map(e=>
              <EventCard key={e.id} e={e} onClick={()=>{setEE(e);setSEF(true);}} onShare={setShare}/>
            )}</div>}
          </div>

          {/* Upcoming events grouped by date */}
          {upcomingGrouped.length>0&&<div style={{marginTop:20}}>
            <h3 style={{margin:"0 0 10px",fontSize:15,fontWeight:700,color:"#1E293B"}}>ğŸ“Œ ë‹¤ê°€ì˜¤ëŠ” ì¼ì •</h3>
            {upcomingGrouped.map(([date,evts])=>{
              const d=pD(date);const dayName=DAYS[d.getDay()];
              const isToday=date===TODAY;
              const hol=HOLIDAYS[date];
              return(<div key={date} style={{marginBottom:12}}>
                <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:6}}>
                  <div style={{width:40,textAlign:"center",background:isToday?"#1E293B":"#F8FAFC",borderRadius:10,padding:"6px 4px"}}>
                    <div style={{fontSize:8,fontWeight:700,color:isToday?"#94A3B8":"#94A3B8"}}>{MOS[d.getMonth()]}</div>
                    <div style={{fontSize:18,fontWeight:800,color:isToday?"#fff":"#1E293B"}}>{d.getDate()}</div>
                    <div style={{fontSize:8,fontWeight:600,color:isToday?"#60A5FA":d.getDay()===0||hol?"#EF4444":d.getDay()===6?"#3B82F6":"#94A3B8"}}>{dayName}</div>
                  </div>
                  <div style={{flex:1,height:1,background:"#E2E8F0"}}/>
                  {hol&&<span style={{fontSize:10,color:"#EF4444",fontWeight:600}}>ğŸŒ {hol}</span>}
                  {isToday&&<span style={{fontSize:9,background:"#1E293B",color:"#fff",padding:"2px 6px",borderRadius:6,fontWeight:700}}>ì˜¤ëŠ˜</span>}
                </div>
                <div style={{display:"flex",flexDirection:"column",gap:4,marginLeft:48}}>
                  {evts.sort((a,b)=>(a.time||"").localeCompare(b.time||"")).map(e=>
                    <EventCard key={e.id} e={e} onClick={()=>{setEE(e);setSEF(true);}} onShare={setShare}/>
                  )}
                </div>
              </div>);
            })}
          </div>}

          {/* Past events */}
          {pastEvs.length>0&&<div style={{marginTop:16}}>
            <h3 style={{margin:"0 0 8px",fontSize:14,fontWeight:700,color:"#94A3B8"}}>ğŸ• ì§€ë‚˜ê°„ ì¼ì •</h3>
            <div style={{display:"flex",flexDirection:"column",gap:4}}>
              {pastEvs.map(e=><EventCard key={e.id} e={e} onClick={()=>{setEE(e);setSEF(true);}} onShare={setShare}/>)}
            </div>
          </div>}
        </>}

        {/* TODO */}
        {tab==="todo"&&<><div style={{display:"flex",gap:5,marginBottom:8,alignItems:"center",flexWrap:"wrap"}}>
          {[["all","ì „ì²´",td.length],["active","ì§„í–‰ì¤‘",td.filter(t=>!t.completed).length],["completed","ì™„ë£Œ",td.filter(t=>t.completed).length]].map(([k,l,c])=>
            <button key={k} onClick={()=>setTF(k)} style={{padding:"5px 10px",borderRadius:20,border:tF===k?"2px solid #1E293B":"2px solid #E2E8F0",background:tF===k?"#1E293B":"#fff",color:tF===k?"#fff":"#64748B",fontWeight:600,fontSize:11,cursor:"pointer"}}>{l}({c})</button>)}
          <div style={{flex:1}}/><select value={tS} onChange={e=>setTS(e.target.value)} style={{padding:"4px 8px",borderRadius:8,border:"1.5px solid #E2E8F0",fontSize:11,color:"#64748B",background:"#fff"}}><option value="priority">ì¤‘ìš”ë„</option><option value="created">ê²½ê³¼ì¼</option><option value="due">ë§ˆê°ì¼</option></select>
        </div>
        {fTd.length===0?<div style={{textAlign:"center",padding:"30px 0",color:"#94A3B8"}}><div style={{fontSize:28}}>âœ¨</div><div style={{fontSize:13,marginTop:4}}>í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤</div></div>
        :<div style={{display:"flex",flexDirection:"column",gap:6}}>{fTd.map(t=>{const p=PRI[t.priority];const days=dBtw(t.createdDate,TODAY);const work=t.completed&&t.completedDate?dBtw(t.createdDate,t.completedDate):null;
          const od=!t.completed&&t.dueDate&&t.dueDate<TODAY;const ds=!t.completed&&t.dueDate&&!od&&dBtw(TODAY,t.dueDate)<=2;
          return(<div key={t.id} className="card" style={{background:"#fff",borderRadius:12,padding:"10px 12px",borderLeft:`4px solid ${t.completed?"#10B981":od?"#EF4444":p.dot}`,boxShadow:"0 1px 3px rgba(0,0,0,0.04)",opacity:t.completed?0.7:1,transition:"all 0.15s"}}>
            <div style={{display:"flex",alignItems:"center",gap:8}}>
              <button onClick={()=>togTd(t.id)} style={{width:20,height:20,borderRadius:6,border:`2px solid ${t.completed?"#10B981":"#CBD5E1"}`,background:t.completed?"#10B981":"#fff",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:11,flexShrink:0}}>{t.completed&&"âœ“"}</button>
              <div style={{flex:1,cursor:"pointer"}} onClick={()=>{setET(t);setSTF(true);}}>
                <div style={{fontSize:13,fontWeight:600,color:t.completed?"#94A3B8":"#1E293B",textDecoration:t.completed?"line-through":"none"}}>{t.title}</div>
                <div style={{display:"flex",gap:5,marginTop:2,flexWrap:"wrap",alignItems:"center"}}>
                  <span style={{fontSize:10,background:p.bg,color:p.text,borderRadius:4,padding:"1px 4px",fontWeight:600}}>{p.label}</span>
                  <span style={{fontSize:10,color:"#94A3B8"}}>ğŸ“{t.category}</span>
                  {!t.completed&&<span style={{fontSize:10,color:days>7?"#EF4444":days>3?"#F97316":"#64748B",fontWeight:days>3?600:400}}>â±{days}ì¼ì§¸</span>}
                  {work!==null&&<span style={{fontSize:10,color:"#10B981",fontWeight:600}}>âœ…{work}ì¼</span>}
                  {t.dueDate&&!t.completed&&<span style={{fontSize:10,color:od?"#EF4444":ds?"#F97316":"#64748B",fontWeight:od||ds?700:400,background:od?"#FEF2F2":ds?"#FFF7ED":"transparent",padding:"1px 4px",borderRadius:4}}>
                    {od?`ğŸš¨${Math.abs(dBtw(t.dueDate,TODAY))}ì¼ì´ˆê³¼`:`ğŸ“…D-${dBtw(TODAY,t.dueDate)}`}</span>}
                </div>
              </div>
              <button onClick={e=>{e.stopPropagation();setShare(t);}} style={{border:"none",background:"none",cursor:"pointer",fontSize:12,padding:1,color:"#94A3B8"}}>â†—ï¸</button>
            </div>
          </div>)})}</div>}
        {td.length>0&&<div style={{marginTop:14,background:"#fff",borderRadius:14,padding:12,boxShadow:"0 1px 3px rgba(0,0,0,0.04)"}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
            <div style={{fontSize:12,fontWeight:700,color:"#1E293B"}}>ğŸ“Š í†µê³„</div>
            {td.filter(t=>t.completed).length>0&&<button onClick={()=>{if(confirm(`ì™„ë£Œëœ ${td.filter(t=>t.completed).length}ê°œ ì‚­ì œ?`))persist("bp-todos",td.filter(t=>!t.completed),setTd);}} style={{fontSize:10,padding:"3px 8px",borderRadius:6,border:"1px solid #FECACA",background:"#FEF2F2",color:"#DC2626",fontWeight:600,cursor:"pointer"}}>ğŸ—‘ ì™„ë£Œì‚­ì œ({td.filter(t=>t.completed).length})</button>}
          </div>
          <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:6}}>
            {[{l:"ì „ì²´",v:td.length,c:"#3B82F6"},{l:"ì™„ë£Œìœ¨",v:`${td.length>0?Math.round(td.filter(t=>t.completed).length/td.length*100):0}%`,c:"#10B981"},
              {l:"í‰ê· ",v:(()=>{const c=td.filter(t=>t.completed&&t.completedDate);return c.length?`${Math.round(c.reduce((s,t)=>s+dBtw(t.createdDate,t.completedDate),0)/c.length)}ì¼`:"-";})(),c:"#F59E0B"},
              {l:"ì´ˆê³¼",v:td.filter(t=>!t.completed&&t.dueDate&&t.dueDate<TODAY).length,c:"#EF4444"}].map(s=><div key={s.l} style={{textAlign:"center"}}><div style={{fontSize:17,fontWeight:800,color:s.c}}>{s.v}</div><div style={{fontSize:9,color:"#94A3B8"}}>{s.l}</div></div>)}
          </div>
        </div>}
        </>}

        {/* MEMO */}
        {tab==="memo"&&<><div style={{display:"flex",gap:4,marginBottom:10,flexWrap:"wrap"}}>
          <button onClick={()=>setMF("all")} style={{padding:"4px 10px",borderRadius:20,border:mF==="all"?"2px solid #1E293B":"2px solid #E2E8F0",background:mF==="all"?"#1E293B":"#fff",color:mF==="all"?"#fff":"#64748B",fontWeight:600,fontSize:11,cursor:"pointer"}}>ì „ì²´</button>
          {Object.entries(MT).map(([k,v])=><button key={k} onClick={()=>setMF(k)} style={{padding:"4px 10px",borderRadius:20,border:mF===k?`2px solid ${v.color}`:"2px solid #E2E8F0",background:mF===k?v.color+"18":"#fff",color:mF===k?v.color:"#64748B",fontWeight:600,fontSize:11,cursor:"pointer"}}>{v.icon} {v.label}</button>)}
        </div>
        {fMe.length===0?<div style={{textAlign:"center",padding:"30px 0",color:"#94A3B8"}}><div style={{fontSize:28}}>ğŸ“</div><div style={{fontSize:13,marginTop:4}}>ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤</div></div>
        :<div style={{display:"flex",flexDirection:"column",gap:6}}>{fMe.map(m=>{const mt=MT[m.type]||MT.free;return(
          <div key={m.id} onClick={()=>{setEM(m);setSMF(true);}} className="card" style={{background:"#fff",borderRadius:12,padding:"10px 12px",borderLeft:`4px solid ${mt.color}`,boxShadow:"0 1px 3px rgba(0,0,0,0.04)",cursor:"pointer",transition:"all 0.15s"}}>
            <div style={{display:"flex",alignItems:"center",gap:5,marginBottom:2}}>
              <span style={{fontSize:12}}>{mt.icon}</span><span style={{fontSize:9,background:mt.color+"20",color:mt.color,borderRadius:4,padding:"1px 4px",fontWeight:700}}>{mt.label}</span>
              <span style={{fontWeight:600,fontSize:13,color:"#1E293B",flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{m.title}</span>
              <span style={{fontSize:11,color:"#94A3B8"}}>{m.date}</span>
              <button onClick={e=>{e.stopPropagation();setShare(m);}} style={{border:"none",background:"none",cursor:"pointer",fontSize:12,padding:1,color:"#94A3B8"}}>â†—ï¸</button>
            </div>
            {m.content&&<div style={{fontSize:12,color:"#64748B",marginLeft:18,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>{m.content}</div>}
            {m.decisions&&<div style={{fontSize:11,color:"#059669",marginLeft:18,marginTop:1}}>âœ… {m.decisions.substring(0,50)}{m.decisions.length>50?"...":""}</div>}
            {m.actionItems&&<div style={{fontSize:11,color:"#D97706",marginLeft:18,marginTop:1}}>ğŸ¯ {m.actionItems.substring(0,50)}{m.actionItems.length>50?"...":""}</div>}
          </div>)})}</div>}</>}

        {/* CONTACTS */}
        {tab==="contacts"&&<>
          {/* Phone import button */}
          <div style={{marginBottom:10}}>
            <button onClick={importContacts} style={{...bS,background:"linear-gradient(135deg,#3B82F6,#6366F1)",color:"#fff",width:"100%",padding:"10px 0",fontSize:13,display:"flex",alignItems:"center",justifyContent:"center",gap:6}}>
              ğŸ“± íœ´ëŒ€í° ì—°ë½ì²˜ ê°€ì ¸ì˜¤ê¸°
            </button>
            <div style={{fontSize:10,color:"#94A3B8",textAlign:"center",marginTop:4}}>Android Chromeì—ì„œ ì§€ì› Â· iPhoneì€ ìˆ˜ë™ ì¶”ê°€</div>
          </div>
          {co.filter(c=>!tQ||c.name.toLowerCase().includes(tQ.toLowerCase())||c.company?.toLowerCase().includes(tQ.toLowerCase())).length===0
          ?<div style={{textAlign:"center",padding:"30px 0",color:"#94A3B8"}}><div style={{fontSize:28}}>ğŸ‘¥</div><div style={{fontSize:13,marginTop:4}}>ì—°ë½ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤</div></div>
          :<><div style={{fontSize:12,color:"#94A3B8",fontWeight:600,marginBottom:6}}>ì´ {co.filter(c=>!tQ||c.name.toLowerCase().includes(tQ.toLowerCase())||c.company?.toLowerCase().includes(tQ.toLowerCase())).length}ëª…</div>
            <div style={{display:"flex",flexDirection:"column",gap:6}}>{co.filter(c=>!tQ||c.name.toLowerCase().includes(tQ.toLowerCase())||c.company?.toLowerCase().includes(tQ.toLowerCase())).sort((a,b)=>a.name.localeCompare(b.name)).map(c=>
              <div key={c.id} onClick={()=>{setEC(c);setSCF(true);}} className="card" style={{background:"#fff",borderRadius:12,padding:"10px 12px",boxShadow:"0 1px 3px rgba(0,0,0,0.04)",cursor:"pointer",display:"flex",alignItems:"center",gap:10,transition:"all 0.15s"}}>
                <div style={{width:36,height:36,borderRadius:10,background:"linear-gradient(135deg,#6366F1,#8B5CF6)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontWeight:700,fontSize:14,flexShrink:0}}>{c.name.charAt(0)}</div>
                <div style={{flex:1}}><div style={{fontSize:13,fontWeight:600,color:"#1E293B"}}>{c.name}{c.position&&<span style={{fontSize:11,color:"#94A3B8",fontWeight:400}}> {c.position}</span>}</div>
                  <div style={{fontSize:12,color:"#64748B"}}>{c.company&&`ğŸ¢ ${c.company}`}{c.phone&&` ğŸ“± ${c.phone}`}</div></div>
                <div style={{display:"flex",gap:4}}>
                  {c.phone&&<a href={`tel:${c.phone}`} onClick={e=>e.stopPropagation()} style={{padding:"4px 8px",borderRadius:8,background:"#DBEAFE",fontSize:12,fontWeight:600,color:"#2563EB",textDecoration:"none"}}>ğŸ“</a>}
                  {c.email&&<a href={`mailto:${c.email}`} onClick={e=>e.stopPropagation()} style={{padding:"4px 8px",borderRadius:8,background:"#F0FDF4",fontSize:12,fontWeight:600,color:"#059669",textDecoration:"none"}}>ğŸ“§</a>}
                </div>
              </div>)}</div></>}</>}
      </div>

      {/* FAB */}
      <button onClick={()=>{if(tab==="schedule"){setEE(null);setSEF(true);}else if(tab==="todo"){setET(null);setSTF(true);}else if(tab==="memo"){setEM(null);setSMF(true);}else{setEC(null);setSCF(true);}}}
        style={{position:"fixed",bottom:24,right:"max(24px, calc(50% - 426px))",width:54,height:54,borderRadius:"50%",border:"none",background:"linear-gradient(135deg,#3B82F6,#6366F1)",color:"#fff",fontSize:26,cursor:"pointer",boxShadow:"0 4px 20px rgba(59,130,246,0.4)",display:"flex",alignItems:"center",justifyContent:"center",transition:"transform 0.2s",zIndex:90}}
        onMouseEnter={e=>e.currentTarget.style.transform="scale(1.1) rotate(90deg)"} onMouseLeave={e=>e.currentTarget.style.transform="scale(1) rotate(0deg)"}>+</button>

      {/* Modals */}
      {sEF&&<EvForm ev={eE} onSave={saveEv} onClose={()=>{setSEF(false);setEE(null);}} onDel={delEv} contacts={co} selDate={sd} onAddC={()=>{setSEF(false);setEC(null);setSCF(true);}}/>}
      {sTF&&<TdForm td={eT} onSave={saveTd} onClose={()=>{setSTF(false);setET(null);}} onDel={delTd}/>}
      {sMF&&<MeForm me={eM} onSave={saveMe} onClose={()=>{setSMF(false);setEM(null);}} onDel={delMe}/>}
      {sCF&&<CoForm co={eC} onSave={saveCo} onClose={()=>{setSCF(false);setEC(null);}} onDel={delCo}/>}
      {share&&<ShareM item={share} onClose={()=>setShare(null)} baseUrl={baseUrl}/>}
      {sSet&&<Settings onClose={()=>setSSet(false)} events={ev} todos={td} memos={me} contacts={co} onRestore={restore} dooray={dooray}/>}
    </div>
  );
}

// â”€â”€â”€ Styles â”€â”€â”€
const iS={width:"100%",padding:"10px 14px",borderRadius:10,border:"1.5px solid #E2E8F0",fontSize:14,color:"#1E293B",outline:"none",background:"#F8FAFC",transition:"border-color 0.2s"};
const lS={display:"block",fontSize:11,fontWeight:600,color:"#64748B",marginBottom:3};
const bS={padding:"10px 18px",borderRadius:10,border:"none",fontWeight:600,fontSize:13,cursor:"pointer",transition:"all 0.15s"};
const clS={border:"none",background:"none",fontSize:20,cursor:"pointer",color:"#94A3B8",padding:4};
const nS={border:"none",background:"#F1F5F9",borderRadius:8,width:32,height:32,cursor:"pointer",fontSize:14,color:"#475569",display:"flex",alignItems:"center",justifyContent:"center"};
const ovS={position:"fixed",inset:0,background:"rgba(0,0,0,0.45)",backdropFilter:"blur(4px)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:200,padding:16};
const mS={background:"#fff",borderRadius:20,padding:22,width:"100%",maxWidth:500,maxHeight:"88vh",overflow:"auto",boxShadow:"0 20px 60px rgba(0,0,0,0.25)"};
const aBS={padding:"6px 10px",borderRadius:8,border:"2px dashed #CBD5E1",background:"#fff",color:"#64748B",fontSize:11,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:3};
const srS={display:"flex",alignItems:"center",gap:8,padding:"7px 10px",cursor:"pointer",borderRadius:8,fontSize:13,color:"#1E293B",borderBottom:"1px solid #F8FAFC"};

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
